<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apparel Machinery | Industrial Equipment</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Cloudinary SDK -->
    <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: #f0f2f5;
            color: #333;
            line-height: 1.6;
            padding: 0;
            overflow-x: hidden;
            height: auto;
            min-height: 100vh;
        }
        
        .container {
            width: 100%;
            margin: 0 auto;
            background: white;
            overflow: visible;
            min-height: auto;
        }
        
        .header-content {
            background: #223449;
            color: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            width: 100%;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        
        .logo-apparel {
            color: white !important;
            margin-right: 5px;
        }
        
        .logo-machinery {
            color: #4a9eff !important;
        }
        
        .logo:hover .logo-apparel {
            color: #4a9eff !important;
        }
        
        .logo:hover .logo-machinery {
            color: white !important;
        }
        
        nav ul {
            display: flex;
            list-style: none;
            gap: 20px;
            margin: 0;
            padding: 0;
        }
        
        nav ul li a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
            cursor: pointer;
            font-size: 0.95rem;
        }
        
        nav ul li a:hover {
            color: #4a9eff;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .cart-icon {
            position: relative;
            font-size: 1.2rem;
            color: white;
            cursor: pointer;
            margin-right: 10px;
        }
        
        .cart-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #e74c3c;
            color: white;
            font-size: 0.65rem;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .admin-indicator {
            background: #4a9eff;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            display: none;
        }
        
        .logout-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            display: none;
            font-size: 0.8rem;
        }
        
        .banner-section {
            position: relative;
            width: 100%;
            height: 200px;
            background: #2c3e50;
            overflow: hidden;
            margin: 0;
        }
        
        .banner-bg {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.6;
        }
        
        .banner-content {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 15px;
            color: white;
        }
        
        .banner-content h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
        }
        
        .banner-content p {
            font-size: 0.9rem;
            max-width: 700px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }
        
        .admin-action-bar {
            display: flex;
            justify-content: center;
            gap: 15px;
            padding: 15px;
            background: #f8f9fa;
            flex-wrap: wrap;
            border-bottom: 1px solid #e0e0e0;
            display: none;
        }
        
        .admin-action-btn {
            background: #2c3e50;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            min-width: 160px;
            justify-content: center;
        }
        
        .admin-action-btn:hover {
            background: #4a9eff;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .categories-section {
            padding: 20px 15px;
            background: white;
        }
        
        .categories-title {
            text-align: center;
            font-size: 1.5rem;
            color: #223449;
            margin-bottom: 15px;
        }
        
        .category-pills {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            overflow-x: auto;
            padding-bottom: 10px;
        }
        
        .cat-pill {
            background: #f1f5f9;
            border: none;
            padding: 8px 16px;
            border-radius: 25px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            font-size: 0.85rem;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .cat-pill.active, .cat-pill:hover {
            background: #4a9eff;
            color: white;
        }
        
        .subcategories-box {
            display: none;
            width: 100%;
            margin-top: 10px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .subcategories-box.active {
            display: flex;
        }
        
        .subcategory-item {
            background: #223449;
            border: none;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.8rem;
            white-space: nowrap;
            color: white;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .subcategory-item:hover, .subcategory-item.active {
            background: #4a9eff;
            color: white;
        }
        
        /* Third level subcategories */
        .third-level-box {
            display: none;
            width: 100%;
            margin-top: 8px;
            padding: 10px;
            background: #e8f4ff;
            border-radius: 6px;
            border: 1px solid #cce7ff;
            flex-wrap: wrap;
            gap: 6px;
        }
        
        .third-level-box.active {
            display: flex;
        }
        
        .third-level-item {
            background: #4a9eff;
            border: none;
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.75rem;
            white-space: nowrap;
            color: white;
        }
        
        .third-level-item:hover, .third-level-item.active {
            background: #3a8eee;
            color: white;
        }
        
        .products-section {
            padding: 20px 15px;
            background: #f8f9fa;
        }
        
        .section-title {
            text-align: center;
            font-size: 1.5rem;
            color: #223449;
            margin-bottom: 15px;
        }
        
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .product-card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
        }
        
        .product-card img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }
        
        .product-info {
            padding: 12px;
            display: flex;
            flex-direction: column;
        }
        
        .product-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 5px;
            color: #223449;
        }
        
        .product-category {
            color: #4a9eff;
            font-weight: 500;
            margin-bottom: 6px;
            font-size: 0.85rem;
        }
        
        .product-price {
            font-size: 1rem;
            font-weight: 700;
            color: #e74c3c;
            margin-bottom: 10px;
            display: none;
        }
        
        .product-description {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 10px;
            flex-grow: 1;
        }
        
        .product-actions {
            display: flex;
            gap: 6px;
            display: none;
        }
        
        .action-btn {
            padding: 6px 10px;
            border: none;
            border-radius: 5px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.8rem;
        }
        
        .action-btn.edit {
            background: #4a9eff;
            color: white;
        }
        
        .action-btn.delete {
            background: #e74c3c;
            color: white;
        }
        
        .add-to-cart-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 7px 10px;
            border-radius: 5px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.3s;
            width: 100%;
            justify-content: center;
            margin-top: 6px;
            font-size: 0.85rem;
        }
        
        .add-to-cart-btn:hover {
            background: #219653;
        }
        
        .features-section {
            padding: 40px 20px;
            background: white;
        }
        
        .features-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 30px;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .feature-box {
            flex: 1;
            min-width: 280px;
            max-width: 350px;
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
            height: auto;
        }
        
        .feature-box:hover {
            transform: translateY(-5px);
        }
        
        .feature-icon {
            font-size: 2.5rem;
            color: #4a9eff;
            margin-bottom: 15px;
        }
        
        .feature-title {
            font-size: 1.3rem;
            color: #223449;
            margin-bottom: 12px;
            font-weight: 600;
        }
        
        .feature-description {
            color: #666;
            line-height: 1.5;
            font-size: 0.95rem;
        }
        
        .footer {
            background: #223449;
            color: white;
            padding: 30px 20px;
            text-align: center;
        }
        
        .footer-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: white;
        }
        
        .footer-tagline {
            margin-bottom: 20px;
            opacity: 0.9;
            font-size: 1rem;
        }
        
        .footer-social {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .footer-social a {
            color: white;
            font-size: 1.3rem;
            transition: color 0.3s;
            text-decoration: none;
        }
        
        .footer-social a:hover {
            color: #4a9eff;
        }
        
        .footer-contact {
            margin-bottom: 15px;
            font-size: 0.95rem;
        }
        
        .footer-contact a {
            color: #4a9eff;
            text-decoration: none;
        }
        
        .footer-author {
            opacity: 0.8;
            margin-top: 20px;
            font-size: 0.9rem;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            width: 90%;
            max-width: 600px;
            border-radius: 10px;
            overflow: hidden;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 12px;
            background: #f8f9fa;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #ddd;
        }
        
        .modal-header h3 {
            margin: 0;
            color: #223449;
            font-size: 1.2rem;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.3rem;
            cursor: pointer;
            color: #666;
        }
        
        .modal-body {
            padding: 15px;
        }
        
        .form-group {
            margin-bottom: 12px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.9rem;
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .modal-footer {
            padding: 12px;
            background: #f8f9fa;
            border-top: 1px solid #ddd;
            text-align: right;
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 12px;
                text-align: center;
            }
            
            nav ul {
                flex-wrap: wrap;
                justify-content: center;
                gap: 12px;
            }
            
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
            
            .admin-action-bar {
                flex-direction: column;
                align-items: center;
            }
            
            .admin-action-btn {
                width: 100%;
                max-width: 250px;
            }
            
            .category-pills {
                justify-content: flex-start;
                overflow-x: auto;
                padding-bottom: 8px;
            }
            
            .banner-content h1 {
                font-size: 1.5rem;
            }
            
            .banner-content p {
                font-size: 0.8rem;
            }
            
            .features-container {
                flex-direction: column;
                align-items: center;
            }
            
            .feature-box {
                min-width: 100%;
            }
            
            .subcategories-box {
                padding: 10px;
            }
            
            .subcategory-item {
                font-size: 0.75rem;
                padding: 5px 10px;
            }
            
            .third-level-box {
                padding: 8px;
            }
            
            .third-level-item {
                font-size: 0.7rem;
                padding: 4px 8px;
            }
        }
        
        .admin-btn {
            background: #2c3e50;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            font-weight: 500;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .admin-btn:hover {
            background: #4a9eff;
        }
        
        .btn-primary {
            background: #4a9eff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            font-weight: 500;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .btn-primary:hover {
            background: #3a8eee;
        }
        
        .btn-secondary {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            font-weight: 500;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .btn-secondary:hover {
            background: #7f8c8d;
        }
        
        .btn-success {
            background: #27ae60;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            font-weight: 500;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .btn-success:hover {
            background: #219653;
        }
        
        .category-list {
            margin-bottom: 15px;
        }
        
        .category-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            border-bottom: 1px solid #eee;
        }
        
        .category-item:last-child {
            border-bottom: none;
        }
        
        .category-actions {
            display: flex;
            gap: 5px;
        }
        
        .ai-assistant-btn {
            background: #8e44ad;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
            width: fit-content;
        }
        
        .ai-assistant-btn:hover {
            background: #7d3c98;
        }
        
        .form-row {
            display: flex;
            gap: 10px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .image-preview {
            max-width: 100%;
            max-height: 200px;
            margin-top: 10px;
            display: none;
        }
        
        .upload-area {
            border: 2px dashed #ddd;
            padding: 15px;
            text-align: center;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 10px;
        }
        
        .upload-area:hover {
            border-color: #4a9eff;
        }
        
        .upload-area i {
            font-size: 2rem;
            color: #4a9eff;
            margin-bottom: 10px;
        }
        
        .ai-description-box {
            display: none;
            margin-top: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            background-color: #f9f9f9;
        }
        
        .ai-description-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .about-section {
            padding: 40px 20px;
            background: white;
            display: none;
        }
        
        .about-content {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }
        
        .about-title {
            font-size: 2rem;
            color: #223449;
            margin-bottom: 20px;
        }
        
        .about-text {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #555;
            margin-bottom: 30px;
        }
        
        .about-features {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
        }
        
        .about-feature {
            flex: 1;
            min-width: 200px;
            max-width: 250px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .about-feature h3 {
            color: #223449;
            margin-bottom: 10px;
        }
        
        .about-feature p {
            color: #666;
            font-size: 0.95rem;
        }
        
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .cart-item-details {
            flex: 1;
        }
        
        .cart-item-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .quantity-control {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .quantity-btn {
            background: #4a9eff;
            color: white;
            border: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .customer-details-form {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
        }
        
        /* Cloudinary Styles */
        .cloudinary-upload-btn {
            background: #4a9eff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            width: 100%;
            justify-content: center;
            margin-top: 10px;
            transition: all 0.3s;
        }
        
        .cloudinary-upload-btn:hover {
            background: #3a8eee;
            transform: translateY(-2px);
        }
        
        .upload-status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            display: none;
            text-align: center;
            font-size: 0.9rem;
        }
        
        .upload-status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .upload-status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .cloudinary-preview {
            max-width: 100%;
            max-height: 200px;
            margin-top: 10px;
            border-radius: 5px;
            display: none;
            border: 2px solid #4a9eff;
        }
        
        /* Emergency Scroll Fix */
        html, body {
            overflow-x: hidden;
            overflow-y: auto !important;
            height: auto !important;
        }
        
        /* Test Button - Fixed Position */
        .test-button {
            position: fixed;
            bottom: 10px;
            right: 10px;
            z-index: 10000;
            background: #8e44ad;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header-content">
            <div class="logo" onclick="openAdminLogin()">
                <span class="logo-apparel">Apparel</span>
                <span class="logo-machinery">Machinery</span>
            </div>
            <nav>
                <ul>
                    <li><a href="#" onclick="showSection('home')">Home</a></li>
                    <li><a href="#" onclick="showSection('products')">Products</a></li>
                    <li><a href="#" onclick="showAboutSection()">About Us</a></li>
                    <li><a href="#" id="contactLink">Contact</a></li>
                </ul>
            </nav>
            <div class="header-right">
                <div class="admin-indicator" id="adminIndicator">
                    <i class="fas fa-user-shield"></i> Admin Mode
                </div>
                <button class="logout-btn" id="logoutBtn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
                <div class="cart-icon" onclick="openCart()">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-badge" id="cartCount">0</span>
                </div>
            </div>
        </div>
        
        <!-- Banner -->
        <div class="banner-section">
            <img class="banner-bg" src="https://images.unsplash.com/photo-1497366754035-f200968a6e72?auto=format&fit=crop&w=800&q=80" alt="Banner" id="bannerImage">
            <div class="banner-content">
                <h1 id="bannerTitle">Premium Industrial Machinery</h1>
                <p id="bannerDescription">Find the best apparel machinery for your business with our extensive collection of industrial machinery.</p>
            </div>
        </div>
        
        <!-- Admin Actions - Hidden by default -->
        <div class="admin-action-bar" id="adminActions">
            <button class="admin-action-btn" onclick="openAddProductModal()">
                <i class="fas fa-plus"></i> Add New Product
            </button>
            <button class="admin-action-btn" onclick="openEditBannerModal()">
                <i class="fas fa-edit"></i> Edit Banner
            </button>
            <button class="admin-action-btn" onclick="openManageCategoriesModal()">
                <i class="fas fa-tags"></i> Manage Categories
            </button>
        </div>
        
        <!-- Categories Section -->
        <div class="categories-section">
            <h2 class="categories-title">Product Categories</h2>
            <div class="category-pills" id="categoryPills">
                <!-- All Products Button -->
                <button class="cat-pill active" data-id="all" onclick="selectCategory('all')">
                    <i class="fas fa-th-large"></i> All Products
                </button>
                
                <!-- Main Categories will be added here by JavaScript -->
            </div>
            
            <!-- Subcategories boxes will be added here by JavaScript -->
        </div>
        
        <!-- Products Section -->
        <div class="products-section" id="productsSection">
            <h2 class="section-title">Our Products</h2>
            <div class="products-grid" id="productsGrid">
                <!-- Product Cards will be generated here -->
            </div>
        </div>

        <!-- About Section -->
        <div class="about-section" id="aboutSection">
            <div class="about-content">
                <h2 class="about-title">About Apparel Machinery</h2>
                <div class="about-text">
                    <p>Apparel Machinery - Your trusted partner for garment manufacturing equipment. We provide industrial sewing machines, cutting equipment, and complete production solutions for the textile industry. Premium quality machinery with professional technical support and maintenance services.</p>
                </div>
                <div class="about-features">
                    <div class="about-feature">
                        <h3>Our Mission</h3>
                        <p>To provide high-quality machinery that enhances productivity and efficiency in the apparel industry.</p>
                    </div>
                    <div class="about-feature">
                        <h3>Our Vision</h3>
                        <p>To be the leading supplier of industrial equipment for textile and garment manufacturers.</p>
                    </div>
                    <div class="about-feature">
                        <h3>Our Values</h3>
                        <p>Quality, reliability, and customer satisfaction are at the core of everything we do.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Features Section -->
        <div class="features-section">
            <div class="features-container">
                <!-- Feature 1 -->
                <div class="feature-box">
                    <div class="feature-icon">
                        <i class="fas fa-cogs"></i>
                    </div>
                    <h3 class="feature-title">Quality Machinery</h3>
                    <p class="feature-description">
                        We provide high-quality industrial machinery for apparel manufacturing with reliable performance.
                    </p>
                </div>
                
                <!-- Feature 2 -->
                <div class="feature-box">
                    <div class="feature-icon">
                        <i class="fas fa-shipping-fast"></i>
                    </div>
                    <h3 class="feature-title">Fast Delivery</h3>
                    <p class="feature-description">
                        We ensure timely delivery of machinery and spare parts to keep your operations running smoothly.
                    </p>
                </div>
                
                <!-- Feature 3 -->
                <div class="feature-box">
                    <div class="feature-icon">
                        <i class="fas fa-headset"></i>
                    </div>
                    <h3 class="feature-title">Expert Support</h3>
                    <p class="feature-description">
                        Our team of experts provides technical support and maintenance services for all our products.
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="footer" id="footerContact">
            <div class="footer-title">Apparel Machinery</div>
            <div class="footer-tagline">Your Trusted Partner for Industrial Equipment</div>
            <div class="footer-social">
                <a href="https://web.facebook.com/Aligo786" target="_blank"><i class="fab fa-facebook"></i></a>
                <a href="https://x.com/m_yameen_ansai1?s=21" target="_blank"><i class="fab fa-twitter"></i></a>
                <a href="https://www.instagram.com/m.yameenansari?igsh=eDRsdjFhMHJwYjd3&utm_source=qr" target="_blank"><i class="fab fa-instagram"></i></a>
                <a href="https://www.linkedin.com/in/muhammad-yameen-1a1a67133/" target="_blank"><i class="fab fa-linkedin"></i></a>
                <a href="#" onclick="redirectToWhatsApp()"><i class="fab fa-whatsapp"></i></a>
            </div>
            <div class="footer-contact">
                Contact: <a href="mailto:apparel.machinery.pk@gmail.com">apparel.machinery.pk@gmail.com</a> | Phone: +923155111330
            </div>
            <div class="footer-author">@Muhammad Yameen Ansari</div>
        </div>
    </div>

    <!-- Admin Login Modal -->
    <div id="adminLoginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Admin Login</h3>
                <button class="close-modal" onclick="closeModal('adminLoginModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="adminUsername">Username</label>
                    <input type="text" id="adminUsername" placeholder="Enter admin username">
                </div>
                <div class="form-group">
                    <label for="adminPassword">Password</label>
                    <input type="password" id="adminPassword" placeholder="Enter admin password">
                </div>
                <div id="loginError" style="color: red; display: none;">Invalid username or password</div>
            </div>
            <div class="modal-footer">
                <button class="admin-btn" onclick="login()">Login</button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Product Modal -->
    <div id="addProductModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="productModalTitle">Add New Product</h3>
                <button class="close-modal" onclick="closeModal('addProductModal')">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editingProductId" value="">
                <div class="form-row">
                    <div class="form-group">
                        <label for="productName">Product Name</label>
                        <input type="text" id="productName" placeholder="Enter product name">
                    </div>
                    <div class="form-group">
                        <label for="productModel">Model No.</label>
                        <input type="text" id="productModel" placeholder="Enter model number">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="productMainCategory">Main Category</label>
                        <select id="productMainCategory" onchange="updateSubcategories()">
                            <option value="">Select Main Category</option>
                            <!-- Main categories will be populated by JavaScript -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="productSubCategory">Sub Category</label>
                        <select id="productSubCategory" onchange="updateSubSubCategories()">
                            <option value="">Select Sub Category</option>
                            <!-- Subcategories will be populated by JavaScript -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="productSubSubCategory">Sub Sub Category</label>
                        <select id="productSubSubCategory">
                            <option value="">Select Sub Sub Category</option>
                            <!-- Sub subcategories will be populated by JavaScript -->
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="productManufacturer">Manufacturer</label>
                        <input type="text" id="productManufacturer" placeholder="Enter manufacturer name">
                    </div>
                    <div class="form-group">
                        <label for="productCondition">Condition</label>
                        <select id="productCondition">
                            <option value="new">New</option>
                            <option value="used">Used</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="productPrice">Price (PKR) - Admin Only</label>
                        <input type="number" id="productPrice" placeholder="Enter product price in PKR">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="productDescription">Description</label>
                    <textarea id="productDescription" placeholder="Enter product description"></textarea>
                    <button type="button" class="ai-assistant-btn" onclick="generateDescription()">
                        <i class="fas fa-robot"></i> Use AI - Translate & Create Description
                    </button>
                    
                    <!-- AI Description Box -->
                    <div class="ai-description-box" id="aiDescriptionBox">
                        <label>AI Generated Description</label>
                        <textarea id="aiGeneratedDescription" readonly></textarea>
                        <div class="ai-description-actions">
                            <button type="button" class="btn-success" onclick="useAIDescription()">Use AI Description</button>
                            <button type="button" class="btn-secondary" onclick="clearAIDescription()">Clear</button>
                        </div>
                    </div>
                </div>
                
                <!-- Cloudinary Upload Section -->
                <div class="form-group">
                    <label>Product Image Upload</label>
                    <button type="button" class="cloudinary-upload-btn" id="cloudinaryUploadBtn">
                        <i class="fas fa-cloud-upload-alt"></i> Upload Image via Cloudinary
                    </button>
                    
                    <div id="uploadStatus" class="upload-status"></div>
                    
                    <img id="cloudinaryPreview" class="cloudinary-preview" alt="Cloudinary Image Preview">
                    
                    <input type="hidden" id="cloudinaryImageUrl" value="">
                </div>
                
                <div class="form-group">
                    <label for="productImageUrl">Image URL (Alternative to upload)</label>
                    <input type="text" id="productImageUrl" placeholder="Enter image URL">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('addProductModal')">Cancel</button>
                <button class="btn-success" id="saveProductBtn" onclick="saveProduct()">Add Product</button>
            </div>
        </div>
    </div>

    <!-- Edit Banner Modal -->
    <div id="editBannerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Banner</h3>
                <button class="close-modal" onclick="closeModal('editBannerModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="bannerTitleInput">Banner Title</label>
                    <input type="text" id="bannerTitleInput" placeholder="Enter banner title">
                </div>
                <div class="form-group">
                    <label for="bannerDescriptionInput">Banner Description</label>
                    <textarea id="bannerDescriptionInput" placeholder="Enter banner description"></textarea>
                </div>
                <div class="form-group">
                    <label for="bannerImageInput">Banner Image URL</label>
                    <input type="text" id="bannerImageInput" placeholder="Enter banner image URL">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('editBannerModal')">Cancel</button>
                <button class="btn-success" onclick="saveBannerChanges()">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Enhanced Manage Categories Modal -->
    <div id="manageCategoriesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Manage Categories</h3>
                <button class="close-modal" onclick="closeModal('manageCategoriesModal')">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Add/Edit Category Form -->
                <div class="form-group">
                    <label id="categoryFormTitle">Add New Category</label>
                    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <select id="parentCategoryLevel" onchange="updateParentCategoryOptions()" style="flex: 1;">
                            <option value="main">Main Category</option>
                            <option value="sub">Sub Category</option>
                            <option value="subsub">Sub Sub Category</option>
                        </select>
                        <select id="parentCategorySelect" style="flex: 1;">
                            <option value="">Select Parent Category</option>
                        </select>
                        <input type="text" id="newCategoryName" placeholder="Enter category name" style="flex: 2;">
                        <button class="btn-primary" id="addCategoryBtn" onclick="addNewCategory()">Add Category</button>
                        <button class="btn-secondary" id="updateCategoryBtn" onclick="updateCategory()" style="display: none;">Update Category</button>
                        <button class="btn-secondary" id="cancelEditBtn" onclick="cancelEditCategory()" style="display: none;">Cancel</button>
                    </div>
                    <input type="hidden" id="editingCategoryId" value="">
                </div>
                
                <!-- Category Position Management -->
                <div class="form-group" id="categoryPositionSection" style="display: none;">
                    <label>Change Category Position</label>
                    <div style="display: flex; gap: 10px;">
                        <select id="positionCategorySelect" style="flex: 1;">
                            <option value="">Select Category</option>
                        </select>
                        <select id="positionDirection" style="flex: 1;">
                            <option value="up">Move Up</option>
                            <option value="down">Move Down</option>
                        </select>
                        <button class="btn-primary" onclick="changeCategoryPosition()">Change Position</button>
                    </div>
                </div>
                
                <div class="category-list">
                    <h4>Existing Categories</h4>
                    <div id="categoriesList">
                        <!-- Categories will be listed here -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-primary" onclick="togglePositionSection()" id="togglePositionBtn">Manage Positions</button>
                <button class="btn-secondary" onclick="closeModal('manageCategoriesModal')">Close</button>
            </div>
        </div>
    </div>

    <!-- Cart Modal -->
    <div id="cartModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Your Cart</h3>
                <button class="close-modal" onclick="closeModal('cartModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="cartItems">
                    <!-- Cart items will be generated here -->
                </div>
                <div id="emptyCartMessage" style="text-align: center; padding: 20px; display: none;">
                    <p>Your cart is empty</p>
                </div>
                <div id="cartTotal" style="text-align: right; font-weight: bold; margin-top: 15px; display: none;">
                    Total: PKR <span id="totalAmount">0</span>
                </div>
                <div class="customer-details-form" id="customerDetailsForm" style="display: none;">
                    <h4>Customer Details</h4>
                    <div class="form-group">
                        <label for="customerName">Full Name</label>
                        <input type="text" id="customerName" placeholder="Enter your full name">
                    </div>
                    <div class="form-group">
                        <label for="customerMobile">Mobile Number</label>
                        <input type="text" id="customerMobile" placeholder="Enter your mobile number">
                    </div>
                    <div class="form-group">
                        <label for="customerEmail">Email Address</label>
                        <input type="email" id="customerEmail" placeholder="Enter your email address">
                    </div>
                    <div class="form-group">
                        <label for="customerAddress">Address</label>
                        <textarea id="customerAddress" placeholder="Enter your complete address"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="customerNearby">Nearby Location/Landmark</label>
                        <input type="text" id="customerNearby" placeholder="Enter nearby location or landmark">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('cartModal')">Continue Shopping</button>
                <button class="btn-primary" id="placeOrderBtn" onclick="placeOrder()" style="display: none;">Place Order</button>
                <button class="btn-success" id="confirmOrderBtn" onclick="confirmOrder()" style="display: none;">Confirm Order</button>
            </div>
        </div>
    </div>

    <script>
        // Cloudinary Configuration
        const CLOUDINARY_CLOUD_NAME = 'dnnag4avr';
        const CLOUDINARY_UPLOAD_PRESET = 'apparel_machinery';

        // Global variables
        let cart = [];
        let isAdmin = false;
        let products = [
            {
                id: 1,
                name: "Industrial Lockstitch Machine",
                model: "LS-2023",
                manufacturer: "Brother",
                mainCategory: "stitching-department",
                subCategory: "lock-stitch-sewing",
                condition: "new",
                price: 125000,
                description: "High-speed industrial lockstitch machine with automatic thread cutter and advanced stitching patterns.",
                image: "https://images.unsplash.com/photo-1586023492125-27b2c045efd7?auto=format&fit=crop&w=500&q=80"
            },
            {
                id: 2,
                name: "Overlock Sewing Machine",
                model: "OL-2022",
                manufacturer: "Juki",
                mainCategory: "stitching-department",
                subCategory: "chain-stitch",
                condition: "used",
                price: 85000,
                description: "Professional overlock machine for finishing edges and seams with precision.",
                image: "https://images.unsplash.com/photo-1595425970377-2f8ded7c7b19?auto=format&fit=crop&w=500&q=80"
            },
            {
                id: 3,
                name: "Industrial Bobbin",
                model: "B-2023",
                manufacturer: "Singer",
                mainCategory: "accessories",
                subCategory: "bobbin",
                condition: "new",
                price: 500,
                description: "High-quality industrial bobbin for smooth thread feeding.",
                image: "https://images.unsplash.com/photo-1596461404969-9ae70f2830c1?auto=format&fit=crop&w=500&q=80"
            }
        ];

        // UPDATED main categories with Washing Department before Other Equipment
        let mainCategories = [
            {
                id: 'cutting-department',
                name: 'Cutting Department',
                subcategories: [
                    {
                        id: 'cutting-machines',
                        name: 'Cutting Machines',
                        subcategories: [
                            { id: 'spreading-machine', name: 'Spreading Machine' },
                            { id: 'straight-knife-cutting', name: 'Straight Knife Cutting Machine' },
                            { id: 'band-knife-cutting', name: 'Band Knife Cutting Machine' },
                            { id: 'round-knife-cutting', name: 'Round Knife Cutting Machine' },
                            { id: 'die-cutting', name: 'Die-cutting Machine' },
                            { id: 'notcher-cutting', name: 'Notcher Cutting Machine' },
                            { id: 'drill-cutting', name: 'Drill Cutting Machine' },
                            { id: 'computer-controlled-cutting', name: 'Computer-controlled Knife Cutting Machine' },
                            { id: 'laser-cutting', name: 'Laser Beam Cutting Machine' },
                            { id: 'water-jet-cutting', name: 'Water Jet Cutting Machine' },
                            { id: 'plasma-cutting', name: 'Plasma Torch Cutting Machine' },
                            { id: 'ribbon-cutting', name: 'Ribbon Cutting Machine' },
                            { id: 'fabric-relaxation', name: 'Fabrics Relaxation Machine' },
                            { id: 'cloth-cutting', name: 'Cloth Cutting Machine' },
                            { id: 'cloth-drill', name: 'Cloth Drill Machine' },
                            { id: 'end-cutter', name: 'End Cutter Machine' }
                        ]
                    }
                ]
            },
            {
                id: 'stitching-department',
                name: 'Stitching Department',
                subcategories: [
                    {
                        id: 'component-machines',
                        name: 'Component Machines',
                        subcategories: [
                            {
                                id: 'button-machines',
                                name: 'Button Machines',
                                subcategories: [
                                    { id: 'lock-stitch-buttonhole', name: 'Lock Stitch Buttonhole Machine' },
                                    { id: 'lock-stitch-button-sewing', name: 'Lock Stitch Button Sewing Machine' },
                                    { id: 'button-wrapping-knotting', name: 'Button Wrapping and Knotting Machine' },
                                    { id: 'computer-button-attaching', name: 'Computer Controlled Direct Drive High Speed Lock Stitch Button Attaching Machine' },
                                    { id: 'computer-buttonholing', name: 'Computer Controlled Direct Drive Eyelet Buttonholing Machine with Auto Thread Trimmer' }
                                ]
                            },
                            {
                                id: 'collar-machines',
                                name: 'Collar Machines',
                                subcategories: [
                                    { id: 'collar-point-trimming-turning', name: 'Collar Point Trimming & Turning Machine' },
                                    { id: 'collar-blocking', name: 'Collar Blocking Machine' },
                                    { id: 'collar-contour-trimming', name: 'Collar Contour Trimming Machine' },
                                    { id: 'pneumatic-collar-notcher', name: 'Pneumatic Collar Notcher' },
                                    { id: 'collar-down-button-lining', name: 'Collar Down Button Lining Feeding Machine' },
                                    { id: 'cool-head-collar-creasing', name: 'Cool Head Collar Creasing Press' }
                                ]
                            },
                            {
                                id: 'cuff-machines',
                                name: 'Cuff Machines',
                                subcategories: [
                                    { id: 'cuff-blocking', name: 'Cuff Blocking Machine' }
                                ]
                            },
                            {
                                id: 'sleeve-machines',
                                name: 'Sleeve Machines',
                                subcategories: [
                                    { id: 'sleeve-placket-fusing', name: 'Sleeve Placket Fusing Rotary Machine' }
                                ]
                            },
                            {
                                id: 'pocket-machines',
                                name: 'Pocket Machines',
                                subcategories: [
                                    { id: 'pneumatic-pocket-creasing', name: 'Pneumatic Steam Pocket Creasing Machine' },
                                    { id: 'computer-pocket-welting', name: 'Computer Controlled Automatic Pocket Welting Sewing Machine' },
                                    { id: 'pocket-facing', name: 'Pocket Facing Automatic Machine' }
                                ]
                            },
                            {
                                id: 'waistband-machines',
                                name: 'Waistband Machines',
                                subcategories: [
                                    { id: 'velcro-attach', name: 'Velcro Attach Machine (Automatic Pattern Sewing Machine)' },
                                    { id: 'velcro-cutting', name: 'Velcro Automatic Cutting Machine' },
                                    { id: 'waistband-fusing', name: 'Waist Band Fusing Attachment Machine' },
                                    { id: 'waistband-joining', name: 'Inner and Outer Waist Band Joining Machine' },
                                    { id: 'waistband-ironing', name: 'Waist Band Ironing Press Machine' },
                                    { id: 'waistband-blind-stitch', name: 'Waist Band Blind Stitch' }
                                ]
                            },
                            {
                                id: 'zipper-machines',
                                name: 'Zipper Machines',
                                subcategories: [
                                    { id: 'endless-zipper', name: 'Endless Zipper Attaching Machine' },
                                    { id: 'auto-zipper-stopper', name: 'Auto Feet Endless Zipper Stopper Attaching Machine' }
                                ]
                            },
                            {
                                id: 'trouser-machines',
                                name: 'Trouser Machines',
                                subcategories: [
                                    { id: 'trouser-crotch-seam', name: 'Trouser Crotch Seam Opening Machine' }
                                ]
                            }
                        ]
                    },
                    {
                        id: 'stitch-type-machines',
                        name: 'Stitch Type Machines',
                        subcategories: [
                            {
                                id: 'lock-stitch',
                                name: 'Lock Stitch Machines',
                                subcategories: [
                                    { id: 'lock-stitch-auto-trimmer', name: 'Lock Stitch Sewing Machine + Auto Thread Trimmer' },
                                    { id: 'lock-stitch-edge-trimmer', name: 'Lock Stitch Vertical Edge Trimmer' },
                                    { id: '2-needle-lock-stitch', name: '2 Needle Lock Stitch Machine' },
                                    { id: 'lock-stitch-sewing', name: 'Lock Stitch Sewing Machine' },
                                    { id: 'lock-stitch-buttonholing', name: 'Lock Stitch Buttonholing Machine' },
                                    { id: 'lock-stitch-button-sewing', name: 'Lock Stitch Button Sewing Machine' },
                                    { id: 'motor-controlled-buttonholing', name: 'Motor Controlled Direct Drive High Speed Lock Stitch Buttonholing Machine' },
                                    { id: 'twin-needle-lock-stitch', name: 'Twin Needle Belt Drive Split Needle Bar Lock Stitcher with Large Hook & Thread Trimmer' }
                                ]
                            },
                            {
                                id: 'chain-stitch',
                                name: 'Chain Stitch Machines',
                                subcategories: [
                                    { id: 'flatbed-2-needle-double-chain', name: 'Flatbed 2 Needle Double Chain Stitch' },
                                    { id: '4-needle-double-chain', name: '4 Needle Double Chain Stitch' },
                                    { id: '33-needle-flatbed-double-chain', name: '33 Needle Flatbed Double Chain Stitch' },
                                    { id: '33-needle-flatbed-single-chain', name: '33 Needle Flatbed Single Chain Stitch' },
                                    { id: '2-needle-4-thread-double-chain', name: '2 Needle 4 Thread Double Chain Stitch' },
                                    { id: '6-thread-safety-stitch', name: '6 Thread Safety Stitch Machine with Automatic Thread Trimmer & Lint Collector' },
                                    { id: '2-needle-5-thread-safety', name: '2 Needle 5 Thread Safety Chain Stitch' },
                                    { id: '2-needle-chain-stitch-flatbed', name: '2 Needle Chain Stitch Flat Bed Machine for Bottom Feed' },
                                    { id: '3-needle-chain-stitch-cylinder', name: '3 Needle Chain Stitch Cylinder Bed (Feed Off the Arm) Machine' },
                                    { id: '4-needle-chain-stitch-flatbed', name: '4 Needles Flat Bed Double Chain Stitch Machine with Rear Puller' },
                                    { id: '3-needle-chain-stitch-flatbed', name: '3 Needle Chain Stitch Flat Bed Machine for Bottom Feed' },
                                    { id: 'chain-stitch-yoke-tag', name: 'Chain Stitch Yoke Tag Machine' },
                                    { id: '3-needle-double-chain-stitch', name: '3 Needle Double Chain Stitch Flat Bed Machine for Bottom Feed' }
                                ]
                            },
                            {
                                id: 'interlock',
                                name: 'Interlock Machines',
                                subcategories: [
                                    { id: '3-needle-5-stitch-interlock', name: '3 Needle 5 Stitch Interlock Cover Stitch Machine' },
                                    { id: '3-needle-5-thread-interlock', name: '3 Needle 5 Thread Interlock Cover Stitch Left Cutter Machine' }
                                ]
                            },
                            {
                                id: 'barktacking',
                                name: 'Barktacking Machines',
                                subcategories: [
                                    { id: 'barktacking-machine', name: 'Barktacking Machine' },
                                    { id: 'computer-bartacking', name: 'Computer Controlled Direct Drive High Speed Bartacking Machine' }
                                ]
                            },
                            {
                                id: 'zigzag',
                                name: 'Zigzag Machines',
                                subcategories: [
                                    { id: '1-needle-zigzag', name: '1 Needle Zigzag (Fagoting) Machine' },
                                    { id: 'auto-zig', name: 'Special Machine of Auto Zig' },
                                    { id: 'zig-cutter', name: 'Zig Cutter Machine' }
                                ]
                            },
                            {
                                id: 'blind-stitch',
                                name: 'Blind Stitch Machines',
                                subcategories: [
                                    { id: 'blind-stitch-machine', name: 'Blind Stitch Machine' }
                                ]
                            },
                            {
                                id: 'other-stitch',
                                name: 'Other Stitch Machines',
                                subcategories: [
                                    { id: 'flatlock', name: 'Flatlock Machine' },
                                    { id: 'flatseam', name: 'Flatseam Machine' },
                                    { id: 'saddle-stitch', name: 'Saddle Stitch Machine' },
                                    { id: 'apw-sewing', name: 'APW Sewing Machine' },
                                    { id: 'feed-of-the-arm', name: 'Feed of the Arm Sewing Machine' },
                                    { id: 'cover-stitch', name: 'Cover Stitch Machine' }
                                ]
                            }
                        ]
                    },
                    {
                        id: 'support-auxiliary-machines',
                        name: 'Support & Auxiliary Machines',
                        subcategories: [
                            { id: 'auto-thread-trimming', name: 'Auto Thread Trimming Machine' },
                            { id: 'thread-sucking', name: 'Thread Sucking Machine' },
                            { id: 'fusing-machine', name: 'Fusing Machine' },
                            { id: 'pneumatic-shirt-folding', name: 'Pneumatic Shirt Folding Table' },
                            { id: 'vacuum-ironing-table', name: 'Vacuum Ironing Table' },
                            { id: 'seam-pressing', name: 'Seam Pressing Machines' },
                            { id: 'spot-tacking', name: 'Spot Tacking Machine' },
                            { id: 'serging', name: 'Serging Automatic Machine' },
                            { id: 'pattern-sewing', name: 'Micro Processor Controlled Automatic Pattern Sewing Machine' },
                            { id: 'topper', name: 'Topper (Steam/Air Blow Finishing Station)' },
                            { id: 'carton-belting', name: 'P.P. Carton Belting Machine' },
                            { id: 'thread-rewinding', name: 'Thread Rewinding Machine (Reconing)' },
                            { id: 'darts-pleats', name: 'Darts & Pleats Machine' },
                            { id: 'shadow-stitch', name: 'Single Needle Shadow Stitch' },
                            { id: 'fly-top-stitch', name: 'Fly Top Stitch Automatic Machine' },
                            { id: 'heel-tape', name: 'Heel Tape Attaching Machine' },
                            { id: 'hem-pressing', name: 'Hem Pressing Machine' },
                            { id: 'slitting-rolling', name: 'Slitting & Rolling Machine' },
                            { id: 'bias-making', name: 'Bias Making & Rolling Machine' },
                            { id: 'super-crease', name: 'Super Crease Machine' }
                        ]
                    }
                ]
            },
            {
                id: 'embroidery-machines',
                name: 'Embroidery Machines',
                subcategories: [
                    { id: 'single-head', name: 'Single Head' },
                    { id: 'multi-head', name: 'Multi Head' },
                    { id: 'tajima', name: 'Tajima' },
                    { id: 'barudan', name: 'Barudan' }
                ]
            },
            // MOVED: Washing Department before Other Equipment
            {
                id: 'washing-department',
                name: 'Washing Department',
                subcategories: [
                    {
                        id: 'washing-machines',
                        name: 'Washing Machines',
                        subcategories: [
                            { id: 'side-loading', name: 'Side Loading Washing Machine' },
                            { id: 'front-loading', name: 'Front Loading Washing Machine' },
                            { id: 'hydro-extractor', name: 'Hydro Extractor Machine' },
                            { id: 'dryer-steam', name: 'Dryer Machine (Steam)' },
                            { id: 'dryer-gas', name: 'Dryer Machine (Gas)' },
                            { id: 'chemical-mixture', name: 'Chemical Mixture Machine' },
                            { id: 'industrial-oven', name: 'Industrial Oven (Gas/Electric)' },
                            { id: 'grinding', name: 'Grinding Machine' },
                            { id: 'tagging', name: 'Tagging Machine' },
                            { id: 'laser', name: 'Laser Machine' },
                            { id: 'pp-spray-gun', name: 'P.P. Spray Gun' },
                            { id: 'steam-chamber-crinkle', name: 'Steam Chamber for Crinkle' },
                            { id: 'etp', name: 'ETP (Effluent Treatment Plant)' },
                            { id: 'sand-blasting-gun', name: 'Sand Blasting Gun' },
                            { id: 'sand-blasting-chamber', name: 'Sand Blasting Chamber' },
                            { id: 'curing', name: 'Curing Machine' }
                        ]
                    }
                ]
            },
            {
                id: 'finishing-department',
                name: 'Finishing Department',
                subcategories: [
                    {
                        id: 'pressing-equipment',
                        name: 'Pressing Equipment',
                        subcategories: [
                            { id: 'steam-press', name: 'Steam Press' },
                            { id: 'ironing-table', name: 'Ironing Table' },
                            { id: 'fusing-machine', name: 'Fusing Machine' },
                            { id: 'vacuum-table', name: 'Vacuum Table' }
                        ]
                    },
                    {
                        id: 'finishing-machines',
                        name: 'Finishing Machines',
                        subcategories: [
                            { id: 'snap-attach', name: 'Snap Attach Full Pneumatic Machine' },
                            { id: 'shank-button', name: 'Shank Button Attached Machine' },
                            { id: 'carton-staple', name: 'Carton Staple Machine' },
                            { id: 'iron-cap', name: 'Iron Cap' },
                            { id: 'iron-plate', name: 'Iron Plate' },
                            { id: 'light-checking-box', name: 'Light Checking Box' },
                            { id: 'moisture-meter', name: 'Moisture Meter' },
                            { id: 'scissor', name: 'Scissor' },
                            { id: 'snap-button', name: 'Snap Button Attached Machine' },
                            { id: 'spray-gun', name: 'Spray Gun' },
                            { id: 'shirt-folding-table', name: 'Stand-up Shirt Folding Table' },
                            { id: 'steam-iron-pressing', name: 'Steam Iron Pressing or Ironing' },
                            { id: 'tag-gun', name: 'Tag Gun' },
                            { id: 'thread-sucking', name: 'Thread Sucking Machine' },
                            { id: 'auto-thread-trimming', name: 'Auto Thread Trimming Machine' },
                            { id: 'vacuum-table', name: 'Vacuum Table' },
                            { id: 'weight-scale', name: 'Weight Scale' },
                            { id: 'spotting-gun', name: 'Spotting Gun' },
                            { id: 'air-steam-spray-gun', name: 'Air Spray Gun & Steam Spray Gun' },
                            { id: 'heat-transfer', name: 'Heat Transfer Machine' },
                            { id: 'plastic-stapler', name: 'Plastic Stapler Machine' },
                            { id: 'pull-testing', name: 'Pull Testing Machine' },
                            { id: 'spot-removing', name: 'Spot Removing Machine with Vacuum & Light' },
                            { id: 'needle-detector', name: 'Needle Detector Machine' },
                            { id: 'barcode-scanning', name: 'Barcode Scanning Machine' },
                            { id: 'embroidery-machine', name: 'Embroidery Machine' },
                            { id: 'fabric-printing', name: 'Fabrics Printing Machine' },
                            { id: 'fusing-machine-finishing', name: 'Fusing Machine' },
                            { id: 'fork-lift', name: 'Fork Lift' },
                            { id: 'fabric-inspection', name: 'Fabric Inspection Machine' },
                            { id: 'digital-hygrometer', name: 'Digital Hygrometer' },
                            { id: 'color-cabinet', name: 'Color Cabinet' }
                        ]
                    }
                ]
            },
            {
                id: 'utility-section',
                name: 'Utility Section',
                subcategories: [
                    {
                        id: 'generators',
                        name: 'Generators',
                        subcategories: [
                            { id: 'diesel', name: 'Diesel Generator' },
                            { id: 'gasoline', name: 'Gasoline Generator' },
                            { id: 'steam-generator', name: 'Steam Generator' },
                            { id: 'silent', name: 'Silent Generator' },
                            { id: 'industrial', name: 'Industrial Generator' }
                        ]
                    },
                    {
                        id: 'compressors',
                        name: 'Compressors',
                        subcategories: [
                            { id: 'piston', name: 'Piston Compressor' },
                            { id: 'screw', name: 'Screw Compressor' },
                            { id: 'oil-free', name: 'Oil Free Compressor' },
                            { id: 'portable', name: 'Portable Compressor' }
                        ]
                    },
                    {
                        id: 'utility-machines',
                        name: 'Utility Machines',
                        subcategories: [
                            { id: 'fire-tube-boiler', name: 'Fire-tube Boiler' },
                            { id: 'generator-utility', name: 'Generator' },
                            { id: 'compressor-utility', name: 'Compressor' },
                            { id: 'air-conditioner', name: 'Air Conditioner' },
                            { id: 'boiler-gas-burner', name: 'Boiler Gas Burner' },
                            { id: 'boiler-filter', name: 'Boiler Filter' },
                            { id: 'water-filter', name: 'Water Filter' },
                            { id: 'boiler-blow-down', name: 'Boiler Blow Down' },
                            { id: 'heating-arrangement', name: 'Heating Arrangement' },
                            { id: 'boiler-pressure-control', name: 'Boiler Pressure Control System' },
                            { id: 'generator-parts', name: 'Different Parts of Generator' },
                            { id: 'gas-feeding-system', name: 'Gas Feeding System' },
                            { id: 'exhaust-system', name: 'Exhaust System' },
                            { id: 'filter', name: 'Filter' },
                            { id: 'compressor-moisture', name: 'Compressor Moisture Management System' },
                            { id: 'air-duct', name: 'Air Duct & Conditioning of Air' },
                            { id: 'dryer-gas-utility', name: 'Dryer Machine (Gas)' }
                        ]
                    }
                ]
            },
            {
                id: 'accessories',
                name: 'Accessories / Spare Parts',
                subcategories: [
                    {
                        id: 'spare-parts',
                        name: 'Spare Parts',
                        subcategories: [
                            { id: 'bobbin-spare', name: 'Bobbin' },
                            { id: 'bobbin-case-spare', name: 'Bobbin Case' },
                            { id: 'feed-dog-spare', name: 'Feed Dog' },
                            { id: 'looper-spare', name: 'Looper' },
                            { id: 'needle-spare', name: 'Needle' },
                            { id: 'presser-foot-spare', name: 'Presser Foot' },
                            { id: 'sm-knife-spare', name: 'S/M Knife' },
                            { id: 'thread-spare', name: 'Thread' },
                            { id: 'sewing-machine-parts-spare', name: 'Sewing Machine Parts' },
                            { id: 'cutting-tools-spare', name: 'Cutting Tools' },
                            { id: 'maintenance-tools-spare', name: 'Maintenance Tools' },
                            { id: 'safety-equipment-spare', name: 'Safety Equipment' }
                        ]
                    },
                    {
                        id: 'finishing-spare-parts',
                        name: 'Finishing Spare Parts',
                        subcategories: [
                            { id: 'snap-attach-spare', name: 'Snap Attach Parts' },
                            { id: 'shank-button-spare', name: 'Shank Button Parts' },
                            { id: 'carton-staple-spare', name: 'Carton Staple Parts' },
                            { id: 'iron-cap-spare', name: 'Iron Cap Parts' },
                            { id: 'iron-plate-spare', name: 'Iron Plate Parts' },
                            { id: 'tag-gun-spare', name: 'Tag Gun Parts' },
                            { id: 'thread-sucking-spare', name: 'Thread Sucking Parts' },
                            { id: 'auto-thread-trimming-spare', name: 'Auto Thread Trimming Parts' },
                            { id: 'vacuum-table-spare', name: 'Vacuum Table Parts' },
                            { id: 'weight-scale-spare', name: 'Weight Scale Parts' },
                            { id: 'spotting-gun-spare', name: 'Spotting Gun Parts' },
                            { id: 'heat-transfer-spare', name: 'Heat Transfer Parts' },
                            { id: 'plastic-stapler-spare', name: 'Plastic Stapler Parts' },
                            { id: 'pull-testing-spare', name: 'Pull Testing Parts' },
                            { id: 'spot-removing-spare', name: 'Spot Removing Parts' },
                            { id: 'needle-detector-spare', name: 'Needle Detector Parts' },
                            { id: 'barcode-scanning-spare', name: 'Barcode Scanning Parts' }
                        ]
                    },
                    {
                        id: 'utility-spare-parts',
                        name: 'Utility Spare Parts',
                        subcategories: [
                            { id: 'generator-spare', name: 'Generator Parts' },
                            { id: 'compressor-spare', name: 'Compressor Parts' },
                            { id: 'boiler-spare', name: 'Boiler Parts' },
                            { id: 'air-conditioner-spare', name: 'Air Conditioner Parts' },
                            { id: 'filter-spare', name: 'Filter Parts' },
                            { id: 'exhaust-system-spare', name: 'Exhaust System Parts' },
                            { id: 'gas-feeding-spare', name: 'Gas Feeding System Parts' }
                        ]
                    }
                ]
            },
            {
                id: 'management-equipment',
                name: 'Management Equipment',
                subcategories: [
                    { id: 'software', name: 'Software' },
                    { id: 'hardware', name: 'Hardware' },
                    { id: 'rfid', name: 'RFID' },
                    { id: 'barcode', name: 'Barcode' }
                ]
            },
            {
                id: 'other-equipment',
                name: 'Other Equipment',
                subcategories: [
                    { id: 'miscellaneous', name: 'Miscellaneous' },
                    { id: 'tools', name: 'Tools' },
                    { id: 'industrial-fans', name: 'Industrial Fans' },
                    { id: 'work-tables', name: 'Work Tables' },
                    { id: 'storage-systems', name: 'Storage Systems' },
                    { id: 'conveyor-belts', name: 'Conveyor Belts' },
                    { id: 'packaging-machines', name: 'Packaging Machines' },
                    { id: 'quality-control', name: 'Quality Control Equipment' },
                    { id: 'laboratory-equipment', name: 'Laboratory Equipment' }
                ]
            }
        ];
        
        // Firebase Admin Password
        const FIREBASE_ADMIN_PASSWORD = "Admin@Apparel2024";
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // Hide admin actions and product actions by default
            document.getElementById('adminActions').style.display = 'none';
            document.getElementById('adminIndicator').style.display = 'none';
            document.getElementById('logoutBtn').style.display = 'none';
            
            // Initialize Cloudinary upload functionality
            initializeCloudinaryUpload();
            
            // Load products from localStorage if available
            const savedProducts = localStorage.getItem('apparelProducts');
            if (savedProducts) {
                products = JSON.parse(savedProducts);
            } else {
                // Save initial products to localStorage
                localStorage.setItem('apparelProducts', JSON.stringify(products));
            }
            
            // Load categories from localStorage if available
            const savedCategories = localStorage.getItem('apparelCategories');
            if (savedCategories) {
                mainCategories = JSON.parse(savedCategories);
            } else {
                // Save initial categories to localStorage
                localStorage.setItem('apparelCategories', JSON.stringify(mainCategories));
            }
            
            // Render categories
            renderCategories();
            
            // Render products
            renderProducts();
            
            // Load cart from localStorage if available
            const savedCart = localStorage.getItem('apparelCart');
            if (savedCart) {
                cart = JSON.parse(savedCart);
                document.getElementById('cartCount').textContent = getTotalCartItems();
            }
            
            // Check if user is already logged in
            checkAdminStatus();
            
            // Add test button for debugging
            addTestButton();
            
            // Fix contact link
            document.getElementById('contactLink').addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('footerContact').scrollIntoView({ behavior: 'smooth' });
            });
        });

        // Cloudinary initialization
        function initializeCloudinaryUpload() {
            console.log('Initializing Cloudinary upload...');
            
            const uploadButton = document.getElementById('cloudinaryUploadBtn');
            if (!uploadButton) return;
            
            const myWidget = cloudinary.createUploadWidget({
                cloudName: CLOUDINARY_CLOUD_NAME,
                uploadPreset: CLOUDINARY_UPLOAD_PRESET
            }, (error, result) => {
                if (!error && result && result.event === "success") {
                    console.log('Done! Here is the image info: ', result.info);
                    document.getElementById('cloudinaryImageUrl').value = result.info.secure_url;
                    document.getElementById('productImageUrl').value = result.info.secure_url;
                    document.getElementById('cloudinaryPreview').src = result.info.secure_url;
                    document.getElementById('cloudinaryPreview').style.display = 'block';
                    
                    document.getElementById('uploadStatus').textContent = 'Image uploaded successfully!';
                    document.getElementById('uploadStatus').className = 'upload-status success';
                    document.getElementById('uploadStatus').style.display = 'block';
                }
            });

            document.getElementById("cloudinaryUploadBtn").addEventListener("click", function(){
                myWidget.open();
            }, false);
        }
        
        // Check if user is already logged in as admin
        function checkAdminStatus() {
            const adminUser = localStorage.getItem('adminUser');
            if (adminUser === 'true') {
                enableAdminMode();
            }
        }
        
        // Render categories with expandable subcategories (3 levels)
        function renderCategories() {
            const categoryPills = document.getElementById('categoryPills');
            
            // Clear existing categories except "All Products"
            const allProductsBtn = categoryPills.querySelector('.cat-pill[data-id="all"]');
            categoryPills.innerHTML = '';
            categoryPills.appendChild(allProductsBtn);
            
            // Add main category buttons
            mainCategories.forEach(mainCat => {
                const mainCatBtn = document.createElement('button');
                mainCatBtn.className = 'cat-pill';
                mainCatBtn.setAttribute('data-id', mainCat.id);
                
                const hasSubcategories = mainCat.subcategories && mainCat.subcategories.length > 0;
                
                if (hasSubcategories) {
                    mainCatBtn.innerHTML = `<i class="fas fa-chevron-down"></i> ${mainCat.name}`;
                    mainCatBtn.addEventListener('click', function() {
                        toggleSubcategories(mainCat.id, 'second');
                    });
                } else {
                    mainCatBtn.innerHTML = `${mainCat.name}`;
                    mainCatBtn.addEventListener('click', function() {
                        selectCategory(mainCat.id);
                    });
                }
                
                categoryPills.appendChild(mainCatBtn);
                
                // Create second level subcategories box if needed
                if (hasSubcategories) {
                    const secondLevelBox = document.createElement('div');
                    secondLevelBox.className = 'subcategories-box';
                    secondLevelBox.id = `subcategories-${mainCat.id}`;
                    
                    // Add second level subcategories
                    mainCat.subcategories.forEach(secondLevelCat => {
                        const secondLevelBtn = document.createElement('button');
                        secondLevelBtn.className = 'subcategory-item';
                        secondLevelBtn.setAttribute('data-id', secondLevelCat.id);
                        
                        const hasThirdLevel = secondLevelCat.subcategories && secondLevelCat.subcategories.length > 0;
                        
                        if (hasThirdLevel) {
                            secondLevelBtn.innerHTML = `<i class="fas fa-chevron-down"></i> ${secondLevelCat.name}`;
                            secondLevelBtn.addEventListener('click', function() {
                                toggleSubcategories(secondLevelCat.id, 'third');
                            });
                        } else {
                            secondLevelBtn.innerHTML = `${secondLevelCat.name}`;
                            secondLevelBtn.addEventListener('click', function() {
                                selectCategory(secondLevelCat.id);
                            });
                        }
                        
                        secondLevelBox.appendChild(secondLevelBtn);
                        
                        // Create third level subcategories box if needed
                        if (hasThirdLevel) {
                            const thirdLevelBox = document.createElement('div');
                            thirdLevelBox.className = 'third-level-box';
                            thirdLevelBox.id = `third-level-${secondLevelCat.id}`;
                            
                            // Add third level subcategories
                            secondLevelCat.subcategories.forEach(thirdLevelCat => {
                                const thirdLevelBtn = document.createElement('button');
                                thirdLevelBtn.className = 'third-level-item';
                                thirdLevelBtn.setAttribute('data-id', thirdLevelCat.id);
                                thirdLevelBtn.textContent = thirdLevelCat.name;
                                
                                thirdLevelBtn.addEventListener('click', function() {
                                    selectCategory(thirdLevelCat.id);
                                });
                                
                                thirdLevelBox.appendChild(thirdLevelBtn);
                            });
                            
                            secondLevelBox.appendChild(thirdLevelBox);
                        }
                    });
                    
                    // Add second level box after the category pills container
                    categoryPills.parentNode.insertBefore(secondLevelBox, categoryPills.nextSibling);
                }
            });
        }
        
        // Toggle subcategories boxes
        function toggleSubcategories(categoryId, level) {
            if (level === 'second') {
                // Close all other second level boxes
                document.querySelectorAll('.subcategories-box').forEach(box => {
                    if (box.id !== `subcategories-${categoryId}`) {
                        box.classList.remove('active');
                        // Also close all third level boxes inside
                        box.querySelectorAll('.third-level-box').forEach(thirdBox => {
                            thirdBox.classList.remove('active');
                        });
                    }
                });
                
                // Toggle the clicked category's second level box
                const secondLevelBox = document.getElementById(`subcategories-${categoryId}`);
                if (secondLevelBox) {
                    secondLevelBox.classList.toggle('active');
                    
                    // Update chevron icon
                    const mainCatBtn = document.querySelector(`.cat-pill[data-id="${categoryId}"] i`);
                    if (secondLevelBox.classList.contains('active')) {
                        if (mainCatBtn) mainCatBtn.className = 'fas fa-chevron-up';
                    } else {
                        if (mainCatBtn) mainCatBtn.className = 'fas fa-chevron-down';
                    }
                }
            } else if (level === 'third') {
                // Close all other third level boxes
                document.querySelectorAll('.third-level-box').forEach(box => {
                    if (box.id !== `third-level-${categoryId}`) {
                        box.classList.remove('active');
                    }
                });
                
                // Toggle the clicked category's third level box
                const thirdLevelBox = document.getElementById(`third-level-${categoryId}`);
                if (thirdLevelBox) {
                    thirdLevelBox.classList.toggle('active');
                    
                    // Update chevron icon
                    const secondLevelBtn = document.querySelector(`.subcategory-item[data-id="${categoryId}"] i`);
                    if (thirdLevelBox.classList.contains('active')) {
                        if (secondLevelBtn) secondLevelBtn.className = 'fas fa-chevron-up';
                    } else {
                        if (secondLevelBtn) secondLevelBtn.className = 'fas fa-chevron-down';
                    }
                }
            }
        }
        
        // Render products
        function renderProducts() {
            const productsGrid = document.getElementById('productsGrid');
            productsGrid.innerHTML = '';
            
            products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.setAttribute('data-category', product.subCategory);
                
                productCard.innerHTML = `
                    <img src="${product.image}" alt="${product.name}" onerror="this.src='https://images.unsplash.com/photo-1560472354-b33ff0c44a43?auto=format&fit=crop&w=500&q=80'">
                    <div class="product-info">
                        <h3 class="product-title">${product.name}</h3>
                        <div class="product-category">${getMainCategoryName(product.mainCategory)} | ${getSubCategoryName(product.subCategory)} | ${product.condition} | Model: ${product.model} | Manufacturer: ${product.manufacturer || 'N/A'}</div>
                        <div class="product-price" style="display: ${isAdmin ? 'block' : 'none'}">PKR ${product.price.toLocaleString()}</div>
                        <p class="product-description">${product.description}</p>
                        <button class="add-to-cart-btn" onclick="addToCart(${product.id})">
                            <i class="fas fa-cart-plus"></i> Add to Cart
                        </button>
                        <div class="product-actions" style="display: ${isAdmin ? 'flex' : 'none'}">
                            <button class="action-btn edit" onclick="editProduct(${product.id})">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="action-btn delete" onclick="deleteProduct(${product.id})">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </div>
                `;
                
                productsGrid.appendChild(productCard);
            });
        }
        
        // Helper function to find category by ID in the entire tree
        function findCategoryById(categoryId, categories = mainCategories) {
            for (const category of categories) {
                if (category.id === categoryId) {
                    return category;
                }
                if (category.subcategories) {
                    const found = findCategoryById(categoryId, category.subcategories);
                    if (found) return found;
                }
            }
            return null;
        }
        
        // Get main category name from main category code
        function getMainCategoryName(mainCategoryCode) {
            const mainCat = findCategoryById(mainCategoryCode);
            return mainCat ? mainCat.name : 'Uncategorized';
        }
        
        // Get subcategory name from subcategory code
        function getSubCategoryName(subCategoryCode) {
            const subCat = findCategoryById(subCategoryCode);
            return subCat ? subCat.name : 'Uncategorized';
        }
        
        // Admin login function
        function openAdminLogin() {
            if (isAdmin) {
                return; // Already logged in
            }
            document.getElementById('adminLoginModal').style.display = 'flex';
        }
        
        // Close modal function
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // Login function
        function login() {
            const username = document.getElementById('adminUsername').value;
            const password = document.getElementById('adminPassword').value;
            const loginError = document.getElementById('loginError');
            
            // Authentication with Firebase password
            if (username === 'admin' && password === FIREBASE_ADMIN_PASSWORD) {
                enableAdminMode();
                
                // Save login state
                localStorage.setItem('adminUser', 'true');
                
                // Close modal
                closeModal('adminLoginModal');
                
                // Clear login form
                document.getElementById('adminUsername').value = '';
                document.getElementById('adminPassword').value = '';
                loginError.style.display = 'none';
                
                alert('Admin login successful!');
            } else {
                // Show error
                loginError.style.display = 'block';
            }
        }
        
        // Enable admin mode
        function enableAdminMode() {
            // Show admin actions
            document.getElementById('adminActions').style.display = 'flex';
            
            // Show product actions
            const productActions = document.querySelectorAll('.product-actions');
            productActions.forEach(action => {
                action.style.display = 'flex';
            });
            
            // Show prices (only for admin)
            const productPrices = document.querySelectorAll('.product-price');
            productPrices.forEach(price => {
                price.style.display = 'block';
            });
            
            // Show admin indicator and logout button
            document.getElementById('adminIndicator').style.display = 'block';
            document.getElementById('logoutBtn').style.display = 'block';
            
            // Set admin flag
            isAdmin = true;
            
            // Re-render products to show prices
            renderProducts();
        }
        
        // Logout function
        function logout() {
            // Hide admin actions
            document.getElementById('adminActions').style.display = 'none';
            
            // Hide product actions
            const productActions = document.querySelectorAll('.product-actions');
            productActions.forEach(action => {
                action.style.display = 'none';
            });
            
            // Hide prices
            const productPrices = document.querySelectorAll('.product-price');
            productPrices.forEach(price => {
                price.style.display = 'none';
            });
            
            // Hide admin indicator and logout button
            document.getElementById('adminIndicator').style.display = 'none';
            document.getElementById('logoutBtn').style.display = 'none';
            
            // Set admin flag
            isAdmin = false;
            
            // Remove login state
            localStorage.removeItem('adminUser');
            
            // Re-render products to hide prices
            renderProducts();
            
            alert('Admin logout successful!');
        }
        
        // Category selection function
        function selectCategory(categoryId) {
            // Remove active class from all pills and items
            document.querySelectorAll('.cat-pill').forEach(pill => {
                pill.classList.remove('active');
            });
            document.querySelectorAll('.subcategory-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelectorAll('.third-level-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Add active class to selected category
            if (categoryId === 'all') {
                document.querySelector('.cat-pill[data-id="all"]').classList.add('active');
            } else {
                const selectedItem = document.querySelector(`[data-id="${categoryId}"]`);
                if (selectedItem) {
                    selectedItem.classList.add('active');
                }
            }
            
            // Get all leaf categories under the selected category
            const leafCategories = getAllLeafCategoriesUnder(categoryId);
            
            // Filter products
            const productCards = document.querySelectorAll('.product-card');
            productCards.forEach(card => {
                if (categoryId === 'all') {
                    card.style.display = 'block';
                } else {
                    const productCategory = card.getAttribute('data-category');
                    if (leafCategories.includes(productCategory)) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                }
            });
        }
        
        // Helper function to get all leaf categories under a category
        function getAllLeafCategoriesUnder(categoryId) {
            if (categoryId === 'all') return ['all'];
            
            const category = findCategoryById(categoryId);
            if (!category) return [categoryId];
            
            let leaves = [];
            
            function findLeaves(cat) {
                if (!cat.subcategories || cat.subcategories.length === 0) {
                    leaves.push(cat.id);
                } else {
                    cat.subcategories.forEach(subCat => {
                        findLeaves(subCat);
                    });
                }
            }
            
            findLeaves(category);
            return leaves;
        }
        
        // Add to cart function
        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            
            if (!product) return;
            
            // Check if product already in cart
            const existingItem = cart.find(item => item.id === productId);
            
            if (existingItem) {
                // Increase quantity
                existingItem.quantity += 1;
            } else {
                // Add new item to cart
                cart.push({
                    id: product.id,
                    name: product.name,
                    model: product.model,
                    manufacturer: product.manufacturer,
                    condition: product.condition,
                    price: product.price,
                    quantity: 1
                });
            }
            
            // Update cart count
            document.getElementById('cartCount').textContent = getTotalCartItems();
            
            // Save to localStorage
            localStorage.setItem('apparelCart', JSON.stringify(cart));
            
            alert(`${product.name} added to cart!`);
        }
        
        // Get total number of items in cart
        function getTotalCartItems() {
            return cart.reduce((total, item) => total + item.quantity, 0);
        }
        
        // Open cart function
        function openCart() {
            const cartModal = document.getElementById('cartModal');
            const cartItems = document.getElementById('cartItems');
            const emptyCartMessage = document.getElementById('emptyCartMessage');
            const cartTotal = document.getElementById('cartTotal');
            const placeOrderBtn = document.getElementById('placeOrderBtn');
            const confirmOrderBtn = document.getElementById('confirmOrderBtn');
            const customerDetailsForm = document.getElementById('customerDetailsForm');
            
            // Reset form state
            customerDetailsForm.style.display = 'none';
            confirmOrderBtn.style.display = 'none';
            placeOrderBtn.style.display = 'none';
            
            if (cart.length === 0) {
                emptyCartMessage.style.display = 'block';
                cartItems.innerHTML = '';
                cartTotal.style.display = 'none';
            } else {
                emptyCartMessage.style.display = 'none';
                cartItems.innerHTML = '';
                
                let total = 0;
                
                cart.forEach(item => {
                    const itemTotal = item.price * item.quantity;
                    total += itemTotal;
                    
                    const cartItem = document.createElement('div');
                    cartItem.className = 'cart-item';
                    cartItem.innerHTML = `
                        <div class="cart-item-details">
                            <strong>${item.name}</strong>
                            <div>Model: ${item.model} | Manufacturer: ${item.manufacturer || 'N/A'} | Condition: ${item.condition}</div>
                            <div style="display: ${isAdmin ? 'block' : 'none'}">Price: PKR ${item.price.toLocaleString()} x ${item.quantity} = PKR ${itemTotal.toLocaleString()}</div>
                        </div>
                        <div class="cart-item-actions">
                            <div class="quantity-control">
                                <button class="quantity-btn" onclick="updateQuantity(${item.id}, ${item.quantity - 1})">-</button>
                                <span>${item.quantity}</span>
                                <button class="quantity-btn" onclick="updateQuantity(${item.id}, ${item.quantity + 1})">+</button>
                            </div>
                            <button class="action-btn delete" onclick="removeFromCart(${item.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    cartItems.appendChild(cartItem);
                });
                
                document.getElementById('totalAmount').textContent = total.toLocaleString();
                cartTotal.style.display = isAdmin ? 'block' : 'none';
                placeOrderBtn.style.display = 'block';
            }
            
            cartModal.style.display = 'flex';
        }
        
        // Update quantity in cart
        function updateQuantity(productId, newQuantity) {
            if (newQuantity < 1) {
                removeFromCart(productId);
                return;
            }
            
            const item = cart.find(item => item.id === productId);
            if (item) {
                item.quantity = newQuantity;
                localStorage.setItem('apparelCart', JSON.stringify(cart));
                document.getElementById('cartCount').textContent = getTotalCartItems();
                openCart();
            }
        }
        
        // Remove item from cart
        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            localStorage.setItem('apparelCart', JSON.stringify(cart));
            document.getElementById('cartCount').textContent = getTotalCartItems();
            openCart();
        }
        
        // Place order - show customer details form
        function placeOrder() {
            document.getElementById('customerDetailsForm').style.display = 'block';
            document.getElementById('placeOrderBtn').style.display = 'none';
            document.getElementById('confirmOrderBtn').style.display = 'block';
        }
        
        // Confirm order and redirect to WhatsApp
        function confirmOrder() {
            const name = document.getElementById('customerName').value;
            const mobile = document.getElementById('customerMobile').value;
            const email = document.getElementById('customerEmail').value;
            const address = document.getElementById('customerAddress').value;
            const nearby = document.getElementById('customerNearby').value;
            
            if (!name || !mobile || !address) {
                alert('Please fill in all required customer details (Name, Mobile, Address)');
                return;
            }
            
            let message = `New Order Request\n\n`;
            message += `Customer Details:\n`;
            message += `Name: ${name}\n`;
            message += `Mobile: ${mobile}\n`;
            message += `Email: ${email || 'Not provided'}\n`;
            message += `Address: ${address}\n`;
            message += `Nearby: ${nearby || 'Not provided'}\n\n`;
            message += `Order Details:\n`;
            
            let total = 0;
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                message += `${item.name} (Model: ${item.model}, Manufacturer: ${item.manufacturer || 'N/A'}, Condition: ${item.condition}) - Qty: ${item.quantity}\n`;
            });
            
            message += `\nTotal Items: ${getTotalCartItems()}`;
            if (isAdmin) {
                message += `\nTotal Amount: PKR ${total.toLocaleString()}`;
            }
            
            // Encode the message for URL
            const encodedMessage = encodeURIComponent(message);
            
            // Redirect to WhatsApp with the order details
            window.open(`https://wa.me/923155111330?text=${encodedMessage}`, '_blank');
            
            // Clear cart after order
            cart = [];
            localStorage.setItem('apparelCart', JSON.stringify(cart));
            document.getElementById('cartCount').textContent = 0;
            closeModal('cartModal');
        }
        
        // Redirect to WhatsApp
        function redirectToWhatsApp() {
            window.open('https://wa.me/923155111330', '_blank');
        }
        
        // Show section function
        function showSection(section) {
            // Hide all sections first
            document.getElementById('productsSection').style.display = 'none';
            document.getElementById('aboutSection').style.display = 'none';
            
            // Show the selected section
            if (section === 'home') {
                document.getElementById('productsSection').style.display = 'block';
            } else if (section === 'products') {
                document.getElementById('productsSection').style.display = 'block';
            }
        }
        
        // Show About section
        function showAboutSection() {
            document.getElementById('productsSection').style.display = 'none';
            document.getElementById('aboutSection').style.display = 'block';
        }
        
        // Scroll to contact section
        function scrollToContact() {
            document.getElementById('footerContact').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Admin functions
        function openAddProductModal() {
            // Reset form for adding new product
            document.getElementById('productModalTitle').textContent = 'Add New Product';
            document.getElementById('saveProductBtn').textContent = 'Add Product';
            document.getElementById('editingProductId').value = '';
            
            // Clear form fields
            document.getElementById('productName').value = '';
            document.getElementById('productModel').value = '';
            document.getElementById('productManufacturer').value = '';
            document.getElementById('productMainCategory').value = '';
            document.getElementById('productSubCategory').value = '';
            document.getElementById('productSubSubCategory').value = '';
            document.getElementById('productCondition').value = 'new';
            document.getElementById('productPrice').value = '';
            document.getElementById('productDescription').value = '';
            document.getElementById('productImageUrl').value = '';
            document.getElementById('cloudinaryImageUrl').value = '';
            document.getElementById('aiDescriptionBox').style.display = 'none';
            
            // Reset Cloudinary preview and status
            document.getElementById('cloudinaryPreview').style.display = 'none';
            document.getElementById('uploadStatus').style.display = 'none';
            
            // Populate main category dropdown
            populateMainCategoryDropdown();
            
            document.getElementById('addProductModal').style.display = 'flex';
        }
        
        // Populate main category dropdown
        function populateMainCategoryDropdown() {
            const mainCategorySelect = document.getElementById('productMainCategory');
            mainCategorySelect.innerHTML = '<option value="">Select Main Category</option>';
            
            mainCategories.forEach(mainCat => {
                const option = document.createElement('option');
                option.value = mainCat.id;
                option.textContent = mainCat.name;
                mainCategorySelect.appendChild(option);
            });
        }
        
        // Update subcategories based on selected main category
        function updateSubcategories() {
            const mainCategoryId = document.getElementById('productMainCategory').value;
            const subCategorySelect = document.getElementById('productSubCategory');
            const subSubCategorySelect = document.getElementById('productSubSubCategory');
            
            // Clear existing options
            subCategorySelect.innerHTML = '<option value="">Select Sub Category</option>';
            subSubCategorySelect.innerHTML = '<option value="">Select Sub Sub Category</option>';
            
            if (!mainCategoryId) return;
            
            // Find the selected main category
            const mainCategory = mainCategories.find(cat => cat.id === mainCategoryId);
            if (!mainCategory || !mainCategory.subcategories) return;
            
            // Add subcategories
            mainCategory.subcategories.forEach(subCat => {
                const option = document.createElement('option');
                option.value = subCat.id;
                option.textContent = subCat.name;
                subCategorySelect.appendChild(option);
            });
        }
        
        // Update sub subcategories based on selected subcategory
        function updateSubSubCategories() {
            const mainCategoryId = document.getElementById('productMainCategory').value;
            const subCategoryId = document.getElementById('productSubCategory').value;
            const subSubCategorySelect = document.getElementById('productSubSubCategory');
            
            // Clear existing options
            subSubCategorySelect.innerHTML = '<option value="">Select Sub Sub Category</option>';
            
            if (!mainCategoryId || !subCategoryId) return;
            
            // Find the selected main category
            const mainCategory = mainCategories.find(cat => cat.id === mainCategoryId);
            if (!mainCategory || !mainCategory.subcategories) return;
            
            // Find the selected subcategory
            const subCategory = mainCategory.subcategories.find(cat => cat.id === subCategoryId);
            if (!subCategory || !subCategory.subcategories) return;
            
            // Add sub subcategories
            subCategory.subcategories.forEach(subSubCat => {
                const option = document.createElement('option');
                option.value = subSubCat.id;
                option.textContent = subSubCat.name;
                subSubCategorySelect.appendChild(option);
            });
        }
        
        // Save product function
        function saveProduct() {
            const productId = document.getElementById('editingProductId').value;
            const name = document.getElementById('productName').value;
            const model = document.getElementById('productModel').value;
            const manufacturer = document.getElementById('productManufacturer').value;
            const mainCategory = document.getElementById('productMainCategory').value;
            const subCategory = document.getElementById('productSubCategory').value;
            const subSubCategory = document.getElementById('productSubSubCategory').value;
            const condition = document.getElementById('productCondition').value;
            const price = document.getElementById('productPrice').value;
            const description = document.getElementById('productDescription').value;
            const imageUrl = document.getElementById('cloudinaryImageUrl').value || document.getElementById('productImageUrl').value;
            
            // Validation
            if (!name || !model || !mainCategory || !condition || !price || !description) {
                alert('Please fill in all required fields');
                return;
            }
            
            if (!imageUrl) {
                alert('Please upload an image or provide an image URL');
                return;
            }
            
            if (productId) {
                // Update existing product
                const index = products.findIndex(p => p.id == productId);
                if (index !== -1) {
                    products[index] = {
                        ...products[index],
                        name,
                        model,
                        manufacturer,
                        mainCategory,
                        subCategory: subSubCategory || subCategory,
                        condition,
                        price: parseFloat(price),
                        description,
                        image: imageUrl
                    };
                }
            } else {
                // Add new product
                const newProduct = {
                    id: products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1,
                    name,
                    model,
                    manufacturer,
                    mainCategory,
                    subCategory: subSubCategory || subCategory,
                    condition,
                    price: parseFloat(price),
                    description,
                    image: imageUrl
                };
                
                products.push(newProduct);
            }
            
            // Save to localStorage
            localStorage.setItem('apparelProducts', JSON.stringify(products));
            
            // Re-render products
            renderProducts();
            
            // Close modal
            closeModal('addProductModal');
            
            alert(productId ? 'Product updated successfully!' : 'Product added successfully!');
        }
        
        // Edit product function
        function editProduct(productId) {
            const product = products.find(p => p.id === productId);
            
            if (!product) return;
            
            // Set form for editing
            document.getElementById('productModalTitle').textContent = 'Edit Product';
            document.getElementById('saveProductBtn').textContent = 'Update Product';
            document.getElementById('editingProductId').value = product.id;
            
            // Fill form fields
            document.getElementById('productName').value = product.name;
            document.getElementById('productModel').value = product.model;
            document.getElementById('productManufacturer').value = product.manufacturer || '';
            document.getElementById('productCondition').value = product.condition;
            document.getElementById('productPrice').value = product.price;
            document.getElementById('productDescription').value = product.description;
            document.getElementById('productImageUrl').value = product.image;
            document.getElementById('cloudinaryImageUrl').value = product.image;
            
            // Populate main category dropdown
            populateMainCategoryDropdown();
            
            // Set main category
            document.getElementById('productMainCategory').value = product.mainCategory;
            
            // Update subcategories
            updateSubcategories();
            
            // Set subcategory
            setTimeout(() => {
                // Find the correct subcategory to select
                const subCategorySelect = document.getElementById('productSubCategory');
                let foundSubCategory = false;
                
                // First, try to find the exact subcategory
                for (let i = 0; i < subCategorySelect.options.length; i++) {
                    if (subCategorySelect.options[i].value === product.subCategory) {
                        subCategorySelect.value = product.subCategory;
                        foundSubCategory = true;
                        break;
                    }
                }
                
                // If not found, look for parent category
                if (!foundSubCategory) {
                    const category = findCategoryById(product.subCategory);
                    if (category) {
                        // Find parent category
                        const parent = findParentCategory(product.subCategory);
                        if (parent) {
                            subCategorySelect.value = parent.id;
                        }
                    }
                }
                
                // Update sub subcategories
                updateSubSubCategories();
                
                // Set sub subcategory if needed
                setTimeout(() => {
                    const subSubCategorySelect = document.getElementById('productSubSubCategory');
                    if (subSubCategorySelect.options.length > 1) {
                        for (let i = 0; i < subSubCategorySelect.options.length; i++) {
                            if (subSubCategorySelect.options[i].value === product.subCategory) {
                                subSubCategorySelect.value = product.subCategory;
                                break;
                            }
                        }
                    }
                }, 100);
            }, 100);
            
            // Show Cloudinary preview if image is from Cloudinary
            const cloudinaryPreview = document.getElementById('cloudinaryPreview');
            if (product.image && product.image.includes('cloudinary.com')) {
                cloudinaryPreview.src = product.image;
                cloudinaryPreview.style.display = 'block';
            } else {
                cloudinaryPreview.style.display = 'none';
            }
            
            document.getElementById('addProductModal').style.display = 'flex';
        }
        
        // Helper function to find parent category
        function findParentCategory(categoryId, categories = mainCategories, parent = null) {
            for (const category of categories) {
                if (category.id === categoryId) {
                    return parent;
                }
                if (category.subcategories) {
                    const found = findParentCategory(categoryId, category.subcategories, category);
                    if (found) return found;
                }
            }
            return null;
        }
        
        // Delete product function
        function deleteProduct(productId) {
            if (!confirm('Are you sure you want to delete this product?')) {
                return;
            }
            
            products = products.filter(p => p.id !== productId);
            localStorage.setItem('apparelProducts', JSON.stringify(products));
            renderProducts();
            alert('Product deleted successfully!');
        }
        
        // Edit banner function
        function openEditBannerModal() {
            // Get current banner values
            const bannerTitle = document.getElementById('bannerTitle').textContent;
            const bannerDescription = document.getElementById('bannerDescription').textContent;
            const bannerImage = document.getElementById('bannerImage').src;
            
            // Set form values
            document.getElementById('bannerTitleInput').value = bannerTitle;
            document.getElementById('bannerDescriptionInput').value = bannerDescription;
            document.getElementById('bannerImageInput').value = bannerImage;
            
            document.getElementById('editBannerModal').style.display = 'flex';
        }
        
        // Save banner changes
        function saveBannerChanges() {
            const newTitle = document.getElementById('bannerTitleInput').value;
            const newDescription = document.getElementById('bannerDescriptionInput').value;
            const newImage = document.getElementById('bannerImageInput').value;
            
            // Update banner
            document.getElementById('bannerTitle').textContent = newTitle;
            document.getElementById('bannerDescription').textContent = newDescription;
            document.getElementById('bannerImage').src = newImage;
            
            // Save to localStorage
            localStorage.setItem('bannerTitle', newTitle);
            localStorage.setItem('bannerDescription', newDescription);
            localStorage.setItem('bannerImage', newImage);
            
            closeModal('editBannerModal');
            alert('Banner updated successfully!');
        }
        
        // Enhanced category management functions
        let editingCategory = null;

        // Update parent category options based on level selection
        function updateParentCategoryOptions() {
            const level = document.getElementById('parentCategoryLevel').value;
            const parentSelect = document.getElementById('parentCategorySelect');
            parentSelect.innerHTML = '<option value="">Select Parent Category</option>';
            
            if (level === 'main') {
                // For main categories, no parent needed
                parentSelect.innerHTML = '<option value="">No Parent (Main Category)</option>';
            } else if (level === 'sub') {
                // For sub categories, show main categories as parents
                mainCategories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.id;
                    option.textContent = category.name;
                    parentSelect.appendChild(option);
                });
            } else if (level === 'subsub') {
                // For sub sub categories, show all categories with subcategories
                mainCategories.forEach(mainCat => {
                    if (mainCat.subcategories && mainCat.subcategories.length > 0) {
                        mainCat.subcategories.forEach(subCat => {
                            const option = document.createElement('option');
                            option.value = subCat.id;
                            option.textContent = `${mainCat.name} → ${subCat.name}`;
                            parentSelect.appendChild(option);
                        });
                    }
                });
            }
        }

        // Enhanced add category function
        function addNewCategory() {
            const level = document.getElementById('parentCategoryLevel').value;
            const parentId = document.getElementById('parentCategorySelect').value;
            const categoryName = document.getElementById('newCategoryName').value.trim();
            
            if (!categoryName) {
                alert('Please enter a category name');
                return;
            }
            
            // Generate ID from name
            const categoryId = categoryName.toLowerCase().replace(/[^a-z0-9]/g, '-');
            
            const newCategory = {
                id: categoryId,
                name: categoryName,
                subcategories: []
            };
            
            if (level === 'main') {
                // Add as main category
                mainCategories.push(newCategory);
            } else if (level === 'sub') {
                // Add as subcategory
                const parentCategory = findCategoryById(parentId);
                if (!parentCategory) {
                    alert('Parent category not found');
                    return;
                }
                if (!parentCategory.subcategories) {
                    parentCategory.subcategories = [];
                }
                parentCategory.subcategories.push(newCategory);
            } else if (level === 'subsub') {
                // Add as sub subcategory
                const parentCategory = findCategoryById(parentId);
                if (!parentCategory) {
                    alert('Parent category not found');
                    return;
                }
                if (!parentCategory.subcategories) {
                    parentCategory.subcategories = [];
                }
                parentCategory.subcategories.push(newCategory);
            }
            
            // Save to localStorage
            localStorage.setItem('apparelCategories', JSON.stringify(mainCategories));
            
            // Clear form
            document.getElementById('newCategoryName').value = '';
            
            // Update categories list
            displayCategoriesList();
            
            // Re-render categories
            renderCategories();
            
            alert('Category added successfully!');
        }

        // Edit category function
        function editCategory(categoryId) {
            const category = findCategoryById(categoryId);
            if (!category) return;
            
            editingCategory = category;
            
            // Set form to edit mode
            document.getElementById('newCategoryName').value = category.name;
            document.getElementById('editingCategoryId').value = categoryId;
            
            // Show update button, hide add button
            document.getElementById('addCategoryBtn').style.display = 'none';
            document.getElementById('updateCategoryBtn').style.display = 'inline-block';
            document.getElementById('cancelEditBtn').style.display = 'inline-block';
            document.getElementById('categoryFormTitle').textContent = 'Edit Category';
            
            // Determine category level and set appropriate options
            const parent = findParentCategory(categoryId);
            if (!parent) {
                document.getElementById('parentCategoryLevel').value = 'main';
                document.getElementById('parentCategorySelect').value = '';
            } else {
                const grandParent = findParentCategory(parent.id);
                if (!grandParent) {
                    document.getElementById('parentCategoryLevel').value = 'sub';
                } else {
                    document.getElementById('parentCategoryLevel').value = 'subsub';
                }
                document.getElementById('parentCategorySelect').value = parent.id;
            }
            
            updateParentCategoryOptions();
        }

        // Update category function
        function updateCategory() {
            const categoryId = document.getElementById('editingCategoryId').value;
            const newName = document.getElementById('newCategoryName').value.trim();
            
            if (!newName) {
                alert('Please enter a category name');
                return;
            }
            
            const category = findCategoryById(categoryId);
            if (!category) return;
            
            // Update category name
            category.name = newName;
            
            // Save to localStorage
            localStorage.setItem('apparelCategories', JSON.stringify(mainCategories));
            
            // Reset form
            cancelEditCategory();
            
            // Update categories list
            displayCategoriesList();
            
            // Re-render categories
            renderCategories();
            
            alert('Category updated successfully!');
        }

        // Cancel edit mode
        function cancelEditCategory() {
            document.getElementById('newCategoryName').value = '';
            document.getElementById('editingCategoryId').value = '';
            document.getElementById('addCategoryBtn').style.display = 'inline-block';
            document.getElementById('updateCategoryBtn').style.display = 'none';
            document.getElementById('cancelEditBtn').style.display = 'none';
            document.getElementById('categoryFormTitle').textContent = 'Add New Category';
            editingCategory = null;
        }

        // Toggle position management section
        function togglePositionSection() {
            const section = document.getElementById('categoryPositionSection');
            const btn = document.getElementById('togglePositionBtn');
            
            if (section.style.display === 'none') {
                section.style.display = 'block';
                btn.textContent = 'Hide Position Management';
                populatePositionCategorySelect();
            } else {
                section.style.display = 'none';
                btn.textContent = 'Manage Positions';
            }
        }

        // Populate category select for position management
        function populatePositionCategorySelect() {
            const select = document.getElementById('positionCategorySelect');
            select.innerHTML = '<option value="">Select Category</option>';
            
            function addCategories(categories, level = 0, path = '') {
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.id;
                    option.textContent = `${path}${category.name}`;
                    select.appendChild(option);
                    
                    if (category.subcategories && category.subcategories.length > 0) {
                        addCategories(category.subcategories, level + 1, `${path}${category.name} → `);
                    }
                });
            }
            
            addCategories(mainCategories);
        }

        // Change category position
        function changeCategoryPosition() {
            const categoryId = document.getElementById('positionCategorySelect').value;
            const direction = document.getElementById('positionDirection').value;
            
            if (!categoryId) {
                alert('Please select a category');
                return;
            }
            
            const category = findCategoryById(categoryId);
            const parent = findParentCategory(categoryId);
            
            let categoriesArray = parent ? parent.subcategories : mainCategories;
            const currentIndex = categoriesArray.findIndex(cat => cat.id === categoryId);
            
            if (direction === 'up' && currentIndex > 0) {
                // Move up
                [categoriesArray[currentIndex - 1], categoriesArray[currentIndex]] = 
                [categoriesArray[currentIndex], categoriesArray[currentIndex - 1]];
            } else if (direction === 'down' && currentIndex < categoriesArray.length - 1) {
                // Move down
                [categoriesArray[currentIndex], categoriesArray[currentIndex + 1]] = 
                [categoriesArray[currentIndex + 1], categoriesArray[currentIndex]];
            } else {
                alert('Cannot move category further in that direction');
                return;
            }
            
            // Save to localStorage
            localStorage.setItem('apparelCategories', JSON.stringify(mainCategories));
            
            // Update categories list
            displayCategoriesList();
            populatePositionCategorySelect();
            
            // Re-render categories
            renderCategories();
            
            alert('Category position changed successfully!');
        }

        // Enhanced display categories list with edit buttons
        function displayCategoriesList() {
            const categoriesList = document.getElementById('categoriesList');
            categoriesList.innerHTML = '';
            
            function displayCategory(category, level = 0) {
                const categoryItem = document.createElement('div');
                categoryItem.className = 'category-item';
                categoryItem.style.paddingLeft = (level * 20) + 'px';
                
                categoryItem.innerHTML = `
                    <div>
                        <strong>${category.name}</strong> (ID: ${category.id})
                        ${level === 0 ? ' - <em>Main Category</em>' : level === 1 ? ' - <em>Sub Category</em>' : ' - <em>Sub Sub Category</em>'}
                    </div>
                    <div class="category-actions">
                        <button class="action-btn edit" onclick="editCategory('${category.id}')">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="action-btn delete" onclick="deleteCategory('${category.id}')">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                `;
                
                categoriesList.appendChild(categoryItem);
                
                if (category.subcategories && category.subcategories.length > 0) {
                    category.subcategories.forEach(subCat => {
                        displayCategory(subCat, level + 1);
                    });
                }
            }
            
            mainCategories.forEach(mainCat => {
                displayCategory(mainCat);
            });
        }

        // Update the openManageCategoriesModal function
        function openManageCategoriesModal() {
            // Initialize parent category options
            updateParentCategoryOptions();
            
            // Reset form
            cancelEditCategory();
            
            // Hide position section by default
            document.getElementById('categoryPositionSection').style.display = 'none';
            document.getElementById('togglePositionBtn').textContent = 'Manage Positions';
            
            // Display categories list
            displayCategoriesList();
            
            document.getElementById('manageCategoriesModal').style.display = 'flex';
        }
        
        // Delete category function (enhanced)
        function deleteCategory(categoryId) {
            if (!confirm('Are you sure you want to delete this category? This will also delete all subcategories and products in this category will become uncategorized.')) {
                return;
            }
            
            // Function to recursively delete category and its subcategories
            function deleteCategoryRecursive(categories, id) {
                for (let i = 0; i < categories.length; i++) {
                    if (categories[i].id === id) {
                        // Delete all products in this category
                        products = products.filter(product => 
                            product.mainCategory !== id && product.subCategory !== id
                        );
                        
                        categories.splice(i, 1);
                        return true;
                    }
                    if (categories[i].subcategories) {
                        if (deleteCategoryRecursive(categories[i].subcategories, id)) {
                            return true;
                        }
                    }
                }
                return false;
            }
            
            // Delete the category
            deleteCategoryRecursive(mainCategories, categoryId);
            
            // Save to localStorage
            localStorage.setItem('apparelCategories', JSON.stringify(mainCategories));
            localStorage.setItem('apparelProducts', JSON.stringify(products));
            
            // Update categories list
            displayCategoriesList();
            
            // Re-render categories and products
            renderCategories();
            renderProducts();
            
            alert('Category deleted successfully!');
        }
        
        // AI Description Generation
        function generateDescription() {
            const productName = document.getElementById('productName').value;
            const productModel = document.getElementById('productModel').value;
            const productManufacturer = document.getElementById('productManufacturer').value;
            const productCondition = document.getElementById('productCondition').value;
            
            if (!productName) {
                alert('Please enter a product name first');
                return;
            }
            
            // Show loading state
            const aiDescriptionBox = document.getElementById('aiDescriptionBox');
            const aiGeneratedDescription = document.getElementById('aiGeneratedDescription');
            aiGeneratedDescription.value = 'Generating description...';
            aiDescriptionBox.style.display = 'block';
            
            // Simulate AI generation (in a real app, this would call an API)
            setTimeout(() => {
                const descriptions = [
                    `${productName} ${productModel ? 'Model ' + productModel : ''} is a high-quality ${productCondition} industrial machine ${productManufacturer ? 'manufactured by ' + productManufacturer : ''}. Designed for efficient operation in apparel manufacturing, this machine offers reliable performance and durability. Suitable for various garment production applications.`,
                    
                    `The ${productName} ${productModel ? '(' + productModel + ')' : ''} is a ${productCondition} condition industrial equipment ${productManufacturer ? 'from ' + productManufacturer : ''}. Built for precision and productivity in textile manufacturing environments. Features robust construction and user-friendly operation for enhanced workflow efficiency.`,
                    
                    `${productManufacturer ? productManufacturer + ' ' : ''}${productName} ${productModel ? 'Model ' + productModel : ''} - a ${productCondition} industrial machine for garment production. Engineered for optimal performance in demanding manufacturing settings. Provides consistent results and easy maintenance for long-term reliability.`
                ];
                
                const randomDescription = descriptions[Math.floor(Math.random() * descriptions.length)];
                aiGeneratedDescription.value = randomDescription;
            }, 1000);
        }
        
        // Use AI generated description
        function useAIDescription() {
            const aiDescription = document.getElementById('aiGeneratedDescription').value;
            document.getElementById('productDescription').value = aiDescription;
        }
        
        // Clear AI description
        function clearAIDescription() {
            document.getElementById('aiGeneratedDescription').value = '';
            document.getElementById('aiDescriptionBox').style.display = 'none';
        }
        
        // Add test button for debugging
        function addTestButton() {
            const testButton = document.createElement('button');
            testButton.className = 'test-button';
            testButton.textContent = 'Test';
            testButton.onclick = function() {
                console.log('Products:', products);
                console.log('Categories:', mainCategories);
                console.log('Cart:', cart);
                alert('Check console for debug information');
            };
            document.body.appendChild(testButton);
        }
    </script>
</body>
</html>