<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apparel Machinery | Industrial Equipment</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: #f0f2f5;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }
        
        /* Header Styles */
        .header-content {
            background: #223449;
            color: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .logo:hover {
            transform: scale(1.05);
        }
        
        .logo span {
            color: #4a9eff;
        }
        
        nav ul {
            display: flex;
            list-style: none;
            gap: 20px;
        }
        
        nav ul li a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
            cursor: pointer;
            font-size: 0.95rem;
        }
        
        nav ul li a:hover {
            color: #4a9eff;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .cart-icon {
            position: relative;
            font-size: 1.2rem;
            color: white;
            cursor: pointer;
            margin-right: 10px;
        }
        
        .cart-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #e74c3c;
            color: white;
            font-size: 0.65rem;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .admin-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.3s;
            font-size: 0.9rem;
        }
        
        .admin-btn:hover {
            background: #c0392b;
        }
        
        /* Banner Styles */
        .banner-section {
            position: relative;
            width: 100%;
            height: 280px;
            background: #2c3e50;
            overflow: hidden;
        }
        
        .banner-bg {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.6;
        }
        
        .banner-content {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 15px;
            color: white;
        }
        
        .banner-content h1 {
            font-size: 2.2rem;
            margin-bottom: 12px;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
        }
        
        .banner-content p {
            font-size: 1rem;
            max-width: 700px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }
        
        /* Admin Actions */
        .admin-action-bar {
            display: flex;
            justify-content: center;
            gap: 12px;
            padding: 20px 15px;
            background: #f8f9fa;
            flex-wrap: wrap;
        }
        
        .admin-action-btn {
            background: #2c3e50;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .admin-action-btn:hover {
            background: #4a9eff;
            transform: translateY(-2px);
        }
        
        /* Categories Section */
        .categories-section {
            padding: 25px 15px;
            background: white;
        }
        
        .categories-title {
            text-align: center;
            font-size: 1.6rem;
            color: #223449;
            margin-bottom: 20px;
        }
        
        .category-pills {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        
        .cat-pill {
            background: #f1f5f9;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            font-size: 0.9rem;
        }
        
        .cat-pill.active, .cat-pill:hover {
            background: #4a9eff;
            color: white;
        }
        
        /* Products Section */
        .products-section {
            padding: 25px 15px;
            background: #f8f9fa;
        }
        
        .section-title {
            text-align: center;
            font-size: 1.7rem;
            color: #223449;
            margin-bottom: 20px;
        }
        
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }
        
        .product-card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
        }
        
        .product-card img {
            width: 100%;
            height: 170px;
            object-fit: cover;
        }
        
        .product-info {
            padding: 15px;
            display: flex;
            flex-direction: column;
        }
        
        .product-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 6px;
            color: #223449;
        }
        
        .product-category {
            color: #4a9eff;
            font-weight: 500;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        
        .product-price {
            font-size: 1.1rem;
            font-weight: 700;
            color: #e74c3c;
            margin-bottom: 12px;
        }
        
        .product-description {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 12px;
            flex-grow: 1;
        }
        
        .product-actions {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            padding: 7px 12px;
            border: none;
            border-radius: 5px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.85rem;
        }
        
        .action-btn.edit {
            background: #4a9eff;
            color: white;
        }
        
        .action-btn.delete {
            background: #e74c3c;
            color: white;
        }
        
        .add-to-cart-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.3s;
            width: 100%;
            justify-content: center;
            margin-top: 8px;
            font-size: 0.9rem;
        }
        
        .add-to-cart-btn:hover {
            background: #219653;
        }
        
        /* Footer */
        .footer {
            background: #223449;
            color: white;
            padding: 20px 15px 15px;
            text-align: center;
        }
        
        .footer-title {
            font-size: 1.3rem;
            margin-bottom: 12px;
        }
        
        .footer-tagline {
            margin-bottom: 20px;
            opacity: 0.9;
            font-size: 0.95rem;
        }
        
        .footer-social {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .footer-social a {
            color: white;
            font-size: 1.3rem;
            transition: color 0.3s;
        }
        
        .footer-social a:hover {
            color: #4a9eff;
        }
        
        .footer-contact {
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        
        .footer-contact a {
            color: #4a9eff;
            text-decoration: none;
        }
        
        .footer-author {
            opacity: 0.8;
            margin-top: 15px;
            font-size: 0.85rem;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            width: 90%;
            max-width: 500px;
            border-radius: 10px;
            overflow: hidden;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 15px;
            background: #f8f9fa;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #ddd;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .modal-header h3 {
            margin: 0;
            color: #223449;
            font-size: 1.2rem;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.4rem;
            cursor: pointer;
            color: #666;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.95rem;
        }
        
        .form-group textarea {
            min-height: 90px;
            resize: vertical;
        }
        
        .form-footer {
            text-align: center;
            margin-top: 15px;
        }
        
        .form-footer a {
            color: #4a9eff;
            text-decoration: none;
        }
        
        .modal-footer {
            padding: 12px 15px;
            background: #f8f9fa;
            border-top: 1px solid #ddd;
            text-align: right;
        }
        
        .admin-info {
            padding: 0 15px 15px;
            text-align: center;
            font-size: 0.85rem;
            color: #666;
        }
        
        .hidden {
            display: none !important;
        }
        
        #noProductsMsg {
            text-align: center;
            grid-column: 1 / -1;
            padding: 25px;
            color: #666;
            font-size: 1rem;
        }
        
        .admin-tooltip {
            position: absolute;
            bottom: -25px;
            left: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }
        
        .logo:hover .admin-tooltip {
            opacity: 1;
        }
        
        /* Image upload styles */
        .image-upload-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .image-preview {
            width: 100%;
            max-height: 200px;
            border: 2px dashed #ddd;
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        
        .image-preview img {
            max-width: 100%;
            max-height: 180px;
            object-fit: contain;
        }
        
        .image-preview-text {
            color: #888;
            padding: 20px;
            text-align: center;
        }
        
        .upload-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .upload-btn {
            background: #4a9eff;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            transition: background 0.3s;
        }
        
        .upload-btn:hover {
            background: #3a8cec;
        }
        
        .upload-btn i {
            font-size: 0.9rem;
        }
        
        .file-input {
            display: none;
        }
        
        .or-divider {
            text-align: center;
            margin: 5px 0;
            color: #888;
            font-size: 0.9rem;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .firebase-error {
            color: #e74c3c;
            text-align: center;
            margin-top: 10px;
            font-size: 0.9rem;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            nav ul {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            .admin-action-bar {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header-content">
            <div class="logo" onclick="openAdminLogin()">
                Apparel <span>Machinery</span>
                <span class="admin-tooltip">Click for Admin Login</span>
            </div>
            <nav>
                <ul>
                    <li><a href="#">Home</a></li>
                    <li><a href="#products">Products</a></li>
                    <li><a href="#" onclick="openAboutPopup(event)">About Us</a></li>
                    <li><a href="#footer">Contact</a></li>
                </ul>
            </nav>
            <div class="header-right">
                <div class="cart-icon" onclick="openCart()">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-badge" id="cartBadge">0</span>
                </div>
                <span class="admin-label hidden" id="adminLabel">Admin</span>
                <button id="logoutBtn" class="admin-btn hidden" onclick="logout()">Sign Out</button>
            </div>
        </div>
        
        <!-- Banner -->
        <div class="banner-section">
            <img class="banner-bg" src="https://images.unsplash.com/photo-1497366754035-f200968a6e72?auto=format&fit=crop&w=800&q=80" alt="Banner">
            <div class="banner-content">
                <h1>Premium Industrial Machinery</h1>
                <p>Find the best apparel machinery for your business with our extensive collection of industrial machinery.</p>
            </div>
        </div>
        
        <!-- Admin Actions -->
        <div class="admin-action-bar hidden" id="adminBar">
            <button class="admin-action-btn" onclick="openProductModal()">
                <i class="fas fa-plus"></i> Add New Product
            </button>
            <button class="admin-action-btn" onclick="openBannerModal()">
                <i class="fas fa-edit"></i> Edit Banner
            </button>
            <button class="admin-action-btn" onclick="viewAllProducts()">
                <i class="fas fa-list"></i> View Products
            </button>
            <button class="admin-action-btn" onclick="openCatModal()">
                <i class="fas fa-tags"></i> Manage Categories
            </button>
        </div>
        
        <!-- Categories Section -->
        <div class="categories-section">
            <h2 class="categories-title">Product Categories</h2>
            <div class="category-pills" id="categoriesPills">
                <!-- Categories will be inserted here by JavaScript -->
            </div>
        </div>
        
        <!-- Products Section -->
        <div class="products-section" id="products">
            <h2 class="section-title">Our Products</h2>
            <div class="products-grid" id="productsGrid">
                <!-- Products will be inserted here by JavaScript -->
            </div>
            <div id="noProductsMsg" class="hidden">No products found in this category</div>
        </div>
        
        <!-- Footer -->
        <div class="footer" id="footer">
            <div class="footer-title">Apparel Machinery</div>
            <div class="footer-tagline">Your Trusted Partner for Industrial Equipment</div>
            <div class="footer-social">
                <a href="https://web.facebook.com/Aligo786" target="_blank"><i class="fab fa-facebook"></i></a>
                <a href="https://x.com/m_yameen_ansai1?s=21" target="_blank"><i class="fab fa-twitter"></i></a>
                <a href="https://www.instagram.com/m.yameenansari?igsh=eDRsdjFhMHJwYjd3&utm_source=qr" target="_blank"><i class="fab fa-instagram"></i></a>
                <a href="https://www.linkedin.com/in/muhammad-yameen-1a1a67133/" target="_blank"><i class="fab fa-linkedin"></i></a>
                <a href="https://wa.me/923155111330" target="_blank"><i class="fab fa-whatsapp"></i></a>
            </div>
            <div class="footer-contact">
                Contact: <a href="mailto:apparel.machinery.pk@gmail.com">apparel.machinery.pk@gmail.com</a> | Phone: +923155111330
            </div>
            <div class="footer-author">© Industrial Sewing Machine | Muhammad Yameen Ansari</div>
        </div>
        
        <!-- Login Modal -->
        <div id="loginModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Admin Login</h3>
                    <button class="close-modal" onclick="closeModal('loginModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="loginForm">
                        <div class="form-group">
                            <label for="loginEmail">Email</label>
                            <input type="email" id="loginEmail" required autocomplete="username" placeholder="Enter admin email">
                        </div>
                        <div class="form-group">
                            <label for="loginPass">Password</label>
                            <input type="password" id="loginPass" required autocomplete="current-password" placeholder="Enter password">
                        </div>
                        <div id="loginError" class="hidden" style="color: #e74c3c; margin-bottom: 12px;">
                            Invalid email or password
                        </div>
                    </form>
                    <div class="form-footer">
                        <a href="#" onclick="showPasswordReset()">Forgot Password?</a>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="admin-btn" id="loginButton" onclick="login()">Login</button>
                </div>
                <div class="admin-info">
                    Contact system administrator for access credentials
                </div>
            </div>
        </div>
        
        <!-- Product Modal -->
        <div id="productModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="productModalTitle">Add New Product</h3>
                    <button class="close-modal" onclick="closeModal('productModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="productForm">
                        <input type="hidden" id="productId">
                        <div class="form-group">
                            <label for="prodTitle">Product Name *</label>
                            <input type="text" id="prodTitle" required placeholder="Enter product name">
                        </div>
                        <div class="form-group">
                            <label for="prodCode">Product Code *</label>
                            <input type="text" id="prodCode" required placeholder="Enter product code">
                        </div>
                        <div class="form-group">
                            <label for="prodManufacturer">Manufacturer *</label>
                            <input type="text" id="prodManufacturer" required placeholder="Enter manufacturer">
                        </div>
                        <div class="form-group">
                            <label for="prodCategory">Category *</label>
                            <select id="prodCategory" required>
                                <!-- Options will be added by JavaScript -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="prodCondition">Condition *</label>
                            <select id="prodCondition" required>
                                <option value="New">New</option>
                                <option value="Used">Used</option>
                                <option value="Refurbished">Refurbished</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="prodDesc">Description *</label>
                            <textarea id="prodDesc" required placeholder="Enter product description"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="prodPrice">Price (PKR) *</label>
                            <input type="number" id="prodPrice" required min="0" placeholder="Enter price">
                        </div>
                        
                        <!-- Image Upload Section -->
                        <div class="form-group">
                            <label>Product Image</label>
                            <div class="image-upload-container">
                                <div class="image-preview" id="imagePreview">
                                    <div class="image-preview-text">Image preview will appear here</div>
                                </div>
                                <div class="upload-options">
                                    <button type="button" class="upload-btn" onclick="document.getElementById('fileInput').click()">
                                        <i class="fas fa-upload"></i> Upload Image
                                    </button>
                                    <input type="file" id="fileInput" class="file-input" accept="image/*" onchange="handleImageUpload(event)">
                                    <div class="or-divider">OR</div>
                                    <input type="text" id="prodImage" placeholder="Enter image URL" onchange="handleUrlChange(event)">
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="admin-btn" onclick="saveProduct()">Save Product</button>
                </div>
            </div>
        </div>
        
        <!-- Category Modal -->
        <div id="catModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Manage Categories</h3>
                    <button class="close-modal" onclick="closeModal('catModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="catList">
                        <!-- Category list will be added by JavaScript -->
                    </div>
                    <form id="addCatForm" style="margin-top: 15px;">
                        <div class="form-group">
                            <label for="newCatInput">Add New Category</label>
                            <input type="text" id="newCatInput" placeholder="Enter category name" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="admin-btn" onclick="addCategory()">Add Category</button>
                </div>
            </div>
        </div>
        
        <!-- About Popup Modal -->
        <div id="aboutModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>About Apparel Machinery</h3>
                    <button class="close-modal" onclick="closeModal('aboutModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Apparel Machinery - Your trusted partner for garment manufacturing equipment. We provide industrial sewing machines, cutting equipment, and complete production solutions for the textile industry. Premium quality machinery with professional technical support and maintenance services.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="admin-btn" onclick="closeModal('aboutModal')">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase configuration - Using your provided config
        const firebaseConfig = {
            apiKey: "AIzaSyB9JR7JTfoC8zeKMFqNzOiQn4mAIrvKXSk",
            authDomain: "apparel-machinery.firebaseapp.com",
            projectId: "apparel-machinery",
            storageBucket: "apparel-machinery.firebasestorage.app",
            messagingSenderId: "165173029685",
            appId: "1:165173029685:web:23d0bc7f2c0752adc63a7c",
            measurementId: "G-XHMZ4BP7CW"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();
        
        // Data
        let categories = [
            "Sewing Machines", "Cutting Machines", "Pressing Equipment", 
            "Embroidery Machines", "Boiler Machines", "Generators", 
            "Compressors", "Accessories", "Management Equipment"
        ];
        
        let products = [
            {
                id: 1,
                title: "Industrial Sewing Machine",
                code: "SM-001",
                manufacturer: "Brother",
                category: "Sewing Machines",
                condition: "New",
                description: "Heavy-duty industrial sewing machine for professional use.",
                price: 85000,
                image: "https://images.unsplash.com/photo-1589254065878-42f9a7a5d26f?auto=format&fit=crop&w=600&q=80"
            },
            {
                id: 2,
                title: "Fabric Cutting Machine",
                code: "FC-002",
                manufacturer: "Eastman",
                category: "Cutting Machines",
                condition: "Refurbished",
                description: "Precision fabric cutting machine with automatic features.",
                price: 120000,
                image: "https://images.unsplash.com/photo-1598703296251-fdc694f1d6bc?auto=format&fit=crop&w=600&q=80"
            }
        ];
        
        let cart = [];
        let selectedCategory = "All";
        let isAdmin = false;
        let uploadedImage = null;
        let uploadedFile = null;
        
        // DOM Elements
        const categoriesPills = document.getElementById('categoriesPills');
        const productsGrid = document.getElementById('productsGrid');
        const noProductsMsg = document.getElementById('noProductsMsg');
        const adminBar = document.getElementById('adminBar');
        const logoutBtn = document.getElementById('logoutBtn');
        const adminLabel = document.getElementById('adminLabel');
        const cartBadge = document.getElementById('cartBadge');
        const imagePreview = document.getElementById('imagePreview');
        const loginButton = document.getElementById('loginButton');
        
        // Initialize the page
        function init() {
            renderCategories();
            renderProducts();
            updateAdminUI();
            updateCartBadge();
            
            // Check if user is already logged in
            auth.onAuthStateChanged(user => {
                if (user) {
                    // User is signed in
                    isAdmin = true;
                    updateAdminUI();
                } else {
                    // User is signed out
                    isAdmin = false;
                    updateAdminUI();
                }
            });
        }
        
        // Render categories
        function renderCategories() {
            categoriesPills.innerHTML = '';
            
            // Add "All" category
            const allPill = document.createElement('button');
            allPill.className = `cat-pill ${selectedCategory === 'All' ? 'active' : ''}`;
            allPill.textContent = 'All Products';
            allPill.addEventListener('click', () => selectCategory('All'));
            categoriesPills.appendChild(allPill);
            
            // Add other categories
            categories.forEach(category => {
                const pill = document.createElement('button');
                pill.className = `cat-pill ${selectedCategory === category ? 'active' : ''}`;
                pill.textContent = category;
                pill.addEventListener('click', () => selectCategory(category));
                categoriesPills.appendChild(pill);
            });
            
            // Also populate the category dropdown in the product modal
            populateCategoryDropdown();
        }
        
        // Populate category dropdown in product modal
        function populateCategoryDropdown() {
            const categoryDropdown = document.getElementById('prodCategory');
            categoryDropdown.innerHTML = '<option value="">Select a category</option>';
            
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categoryDropdown.appendChild(option);
            });
        }
        
        // Select category
        function selectCategory(category) {
            selectedCategory = category;
            renderCategories();
            renderProducts();
        }
        
        // Render products
        function renderProducts() {
            productsGrid.innerHTML = '';
            
            let filteredProducts = products;
            if (selectedCategory !== 'All') {
                filteredProducts = products.filter(product => product.category === selectedCategory);
            }
            
            if (filteredProducts.length === 0) {
                noProductsMsg.classList.remove('hidden');
                return;
            }
            
            noProductsMsg.classList.add('hidden');
            
            filteredProducts.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                
                productCard.innerHTML = `
                    <img src="${product.image}" alt="${product.title}">
                    <div class="product-info">
                        <h3 class="product-title">${product.title}</h3>
                        <div class="product-category">${product.category}</div>
                        <div class="product-price">PKR ${product.price.toLocaleString()}</div>
                        <div class="product-description">${product.description}</div>
                        <button class="add-to-cart-btn" onclick="addToCart(${product.id})">
                            <i class="fas fa-cart-plus"></i> Add to Cart
                        </button>
                        ${isAdmin ? `
                        <div class="product-actions">
                            <button class="action-btn edit" onclick="editProduct(${product.id})">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="action-btn delete" onclick="deleteProduct(${product.id})">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                        ` : ''}
                    </div>
                `;
                
                productsGrid.appendChild(productCard);
            });
        }
        
        // Update admin UI
        function updateAdminUI() {
            if (isAdmin) {
                adminBar.classList.remove('hidden');
                logoutBtn.classList.remove('hidden');
                adminLabel.classList.remove('hidden');
            } else {
                adminBar.classList.add('hidden');
                logoutBtn.classList.add('hidden');
                adminLabel.classList.add('hidden');
            }
            renderProducts(); // Re-render products to show/hide admin buttons
        }
        
        // Open admin login
        function openAdminLogin() {
            openModal('loginModal');
        }
        
        // Login function with Firebase
        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPass').value;
            const loginError = document.getElementById('loginError');
            
            // Basic validation
            if (!email || !password) {
                loginError.textContent = 'Please enter both email and password';
                loginError.classList.remove('hidden');
                return;
            }
            
            try {
                // Show loading state
                loginButton.innerHTML = '<div class="loading"></div> Logging in...';
                loginButton.disabled = true;
                
                // Sign in with Firebase
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                // Check if user is admin (you might want to set up custom claims in Firebase)
                // For now, we'll assume any authenticated user is admin
                isAdmin = true;
                updateAdminUI();
                closeModal('loginModal');
                
            } catch (error) {
                // Handle errors
                console.error("Login error:", error);
                
                // Show appropriate error message
                let errorMessage = "Invalid email or password";
                if (error.code === "auth/user-not-found") {
                    errorMessage = "No account found with this email";
                } else if (error.code === "auth/wrong-password") {
                    errorMessage = "Incorrect password";
                }
                
                loginError.textContent = errorMessage;
                loginError.classList.remove('hidden');
            } finally {
                // Reset button
                loginButton.innerHTML = 'Login';
                loginButton.disabled = false;
            }
        }
        
        // Logout function
        function logout() {
            auth.signOut().then(() => {
                isAdmin = false;
                updateAdminUI();
            }).catch(error => {
                console.error("Logout error:", error);
            });
        }
        
        // Password reset function
        function showPasswordReset() {
            const email = document.getElementById('loginEmail').value;
            if (!email) {
                alert('Please enter your email address first');
                return;
            }
            
            auth.sendPasswordResetEmail(email).then(() => {
                alert('Password reset email sent! Check your inbox.');
            }).catch(error => {
                console.error("Password reset error:", error);
                alert('Error sending password reset email: ' + error.message);
            });
        }
        
        // Add to cart
        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            const existingItem = cart.find(item => item.id === productId);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    id: product.id,
                    title: product.title,
                    price: product.price,
                    image: product.image,
                    quantity: 1
                });
            }
            
            updateCartBadge();
            alert('Product added to cart!');
        }
        
        // Update cart badge
        function updateCartBadge() {
            const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
            cartBadge.textContent = totalItems;
        }
        
        // Open cart
        function openCart() {
            if (cart.length === 0) {
                alert('Your cart is empty!');
                return;
            }
            alert('Cart functionality will be implemented here.');
        }
        
        // Open about popup
        function openAboutPopup(e) {
            e.preventDefault();
            openModal('aboutModal');
        }
        
        // Open modal
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }
        
        // Close modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // Admin functions
        function openProductModal() {
            document.getElementById('productModalTitle').textContent = 'Add New Product';
            document.getElementById('productForm').reset();
            document.getElementById('productId').value = '';
            uploadedImage = null;
            uploadedFile = null;
            imagePreview.innerHTML = '<div class="image-preview-text">Image preview will appear here</div>';
            
            // Make sure category dropdown is populated
            populateCategoryDropdown();
            
            openModal('productModal');
        }
        
        function editProduct(id) {
            const product = products.find(p => p.id === id);
            if (!product) return;
            
            document.getElementById('productModalTitle').textContent = 'Edit Product';
            document.getElementById('productId').value = product.id;
            document.getElementById('prodTitle').value = product.title;
            document.getElementById('prodCode').value = product.code;
            document.getElementById('prodManufacturer').value = product.manufacturer;
            document.getElementById('prodCategory').value = product.category;
            document.getElementById('prodCondition').value = product.condition;
            document.getElementById('prodDesc').value = product.description;
            document.getElementById('prodPrice').value = product.price;
            document.getElementById('prodImage').value = product.image;
            
            // Show image preview
            if (product.image) {
                imagePreview.innerHTML = `<img src="${product.image}" alt="Preview">`;
            } else {
                imagePreview.innerHTML = '<div class="image-preview-text">No image available</div>';
            }
            
            uploadedImage = null;
            uploadedFile = null;
            openModal('productModal');
        }
        
        async function saveProduct() {
            const id = document.getElementById('productId').value;
            const title = document.getElementById('prodTitle').value;
            const code = document.getElementById('prodCode').value;
            const manufacturer = document.getElementById('prodManufacturer').value;
            const category = document.getElementById('prodCategory').value;
            const condition = document.getElementById('prodCondition').value;
            const description = document.getElementById('prodDesc').value;
            const price = parseFloat(document.getElementById('prodPrice').value);
            const imageUrl = document.getElementById('prodImage').value;
            
            if (!title || !code || !manufacturer || !category || !condition || !description || !price) {
                alert('Please fill all required fields');
                return;
            }
            
            let image = imageUrl;
            
            // If a file was uploaded, upload it to Firebase Storage
            if (uploadedFile) {
                try {
                    const storageRef = storage.ref();
                    const fileRef = storageRef.child(`products/${Date.now()}_${uploadedFile.name}`);
                    const snapshot = await fileRef.put(uploadedFile);
                    image = await snapshot.ref.getDownloadURL();
                } catch (error) {
                    console.error("Error uploading image:", error);
                    alert("Error uploading image. Using URL instead.");
                }
            }
            
            const productData = {
                title, code, manufacturer, category, condition, description, price, image
            };
            
            if (id) {
                // Update existing product
                const index = products.findIndex(p => p.id === parseInt(id));
                if (index !== -1) {
                    products[index] = { ...products[index], ...productData };
                }
            } else {
                // Add new product
                productData.id = Date.now();
                products.push(productData);
            }
            
            renderProducts();
            closeModal('productModal');
        }
        
        function deleteProduct(id) {
            if (confirm('Are you sure you want to delete this product?')) {
                products = products.filter(p => p.id !== id);
                renderProducts();
            }
        }
        
        function openBannerModal() {
            alert('Edit Banner functionality will be implemented here.');
        }
        
        function viewAllProducts() {
            selectedCategory = 'All';
            renderCategories();
            renderProducts();
            document.getElementById('products').scrollIntoView({ behavior: 'smooth' });
        }
        
        function openCatModal() {
            openModal('catModal');
        }
        
        function addCategory() {
            const newCategory = document.getElementById('newCatInput').value.trim();
            
            if (!newCategory) {
                alert('Please enter a category name');
                return;
            }
            
            if (categories.includes(newCategory)) {
                alert('This category already exists');
                return;
            }
            
            categories.push(newCategory);
            renderCategories();
            document.getElementById('newCatInput').value = '';
        }
        
        // Handle image upload
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Check if file is an image
            if (!file.type.match('image.*')) {
                alert('Please select an image file');
                return;
            }
            
            uploadedFile = file;
            const reader = new FileReader();
            
            reader.onload = function(e) {
                // Store the base64 image data for preview
                uploadedImage = e.target.result;
                
                // Show preview
                imagePreview.innerHTML = `<img src="${uploadedImage}" alt="Preview">`;
                
                // Clear URL field
                document.getElementById('prodImage').value = '';
            };
            
            reader.readAsDataURL(file);
        }
        
        // Handle URL change
        function handleUrlChange(event) {
            const url = event.target.value;
            if (!url) return;
            
            // Clear uploaded image
            uploadedImage = null;
            uploadedFile = null;
            
            // Show preview from URL
            imagePreview.innerHTML = `<img src="${url}" alt="Preview" onerror="this.onerror=null; this.parentElement.innerHTML='<div class=\'image-preview-text\'>Failed to load image from URL</div>'; uploadedImage=null;">`;
        }
        
        // Initialize when page loads
        window.onload = init;
    </script>
</body>
</html>